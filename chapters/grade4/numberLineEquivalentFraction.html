<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Master: Equivalent Fractions</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #f5a623;
            --success: #2ecc71;
            --error: #e74c3c;
            --bg: #f4f7f6;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Header & Nav */
        header {
            background-color: var(--primary);
            color: white;
            width: 100%;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.8rem; }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 0 10px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .nav-btn.active, .nav-btn:hover {
            background: white;
            color: var(--primary);
        }

        /* Game Container */
        .game-container {
            background: white;
            width: 90%;
            max-width: 700px;
            margin: 20px auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
            display: none; /* Hidden by default, JS toggles this */
        }

        .game-container.active { display: block; }

        .instruction { font-size: 1.2rem; margin-bottom: 20px; color: #555; }

        /* GAME 1: Number Lines */
        .number-line-wrapper {
            margin: 30px 0;
            position: relative;
            height: 80px;
        }

        .nl-label { font-weight: bold; margin-bottom: 5px; display: block; text-align: left; }
        
        .line {
            height: 6px;
            background: #e6e9ee;
            position: relative;
            margin-top: 20px;
            border-radius: 3px;
            margin-left: 20px;
            margin-right: 20px;
        }

        /* filled portion showing the fraction part */
        .line .fill {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            height: 100%;
            background: var(--primary);
            border-radius: 3px 0 0 3px;
            z-index: 1;
            transition: width 0.25s ease;
        }

        .tick {
            position: absolute;
            width: 4px;
            height: 20px;
            background: #333;
            top: -7px;
            transform: translateX(-50%);
            cursor: pointer;
            transition: 0.2s;
            z-index: 3;
        }

        .tick:hover { height: 25px; background: var(--primary); }
        
        /* The dot indicating the value */
        .point {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--secondary);
            border-radius: 50%;
            top: -7px;
            transform: translateX(-50%);
            z-index: 2;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: left 0.3s ease;
        }

        .tick-label {
            position: absolute;
            top: 25px;
            transform: translateX(-50%);
            font-size: 0.9rem;
            user-select: none;
        }

        /* GAME 2: Pie Charts */
        .pies-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }

        .pie-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .pie {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #eee;
            border: 4px solid #333;
            position: relative;
            /* Conic gradient handled by JS */
        }

        /* make the user pie more obvious with a stronger outer border */
        #pie-user {
            border-color: #000;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.03) inset;
        }

        /* separators overlay draws thin radial lines to show slice divisions */
        .pie .separators {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            z-index: 4;
            pointer-events: none;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .control-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* GAME 3: Missing Number */
        .equation-box {
            font-size: 3rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
        }

        .numerator { border-bottom: 3px solid black; padding: 0 10px; }
        .denominator { padding: 0 10px; }
        
        input.fraction-input {
            width: 60px;
            height: 50px;
            font-size: 2rem;
            text-align: center;
            border: 3px solid var(--primary);
            border-radius: 8px;
        }

        /* UI Feedback */
        .action-btn {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #27ae60;
            transition: transform 0.1s;
        }

        .action-btn:active { transform: translateY(4px); box-shadow: none; }

        .feedback-msg {
            height: 30px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .correct-anim { color: var(--success); animation: pop 0.3s ease; }
        .wrong-anim { color: var(--error); animation: shake 0.4s ease; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        @keyframes pop {
            50% { transform: scale(1.2); }
        }

    </style>
</head>
<body>

<header>
    <h1>Fraction Master</h1>
    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchMode('numberline')">Number Lines</button>
        <button class="nav-btn" onclick="switchMode('visual')">Visual Match</button>
        <button class="nav-btn" onclick="switchMode('missing')">Fill the Blank</button>
    </div>
</header>

<!-- GAME 1: NUMBER LINES -->
<div id="game-numberline" class="game-container active">
    <h2>Match the Number Lines</h2>
    <p class="instruction">Click on the <strong>bottom</strong> number line to find the equivalent fraction shown on the top line.</p>
    
    <div id="nl-canvas">
        <!-- Lines injected via JS -->
    </div>

    <div id="nl-feedback" class="feedback-msg"></div>
    <button class="action-btn" onclick="checkNumberLine()">Check Answer</button>
</div>

<!-- GAME 2: VISUAL PIES -->
<div id="game-visual" class="game-container">
    <h2>Visual Match</h2>
    <p class="instruction">Adjust the chart on the right to cover the same amount of space as the chart on the left.</p>
    
    <div class="pies-area">
        <!-- Reference Pie -->
        <div class="pie-wrapper">
            <div id="pie-ref" class="pie"></div>
            <h3>Target</h3>
            <div class="fraction-display" id="pie-ref-text">1/2</div>
        </div>

        <!-- Equals Sign -->
        <div style="display:flex; align-items:center; font-size: 2rem;">=</div>

        <!-- User Pie -->
        <div class="pie-wrapper">
            <div id="pie-user" class="pie"></div>
            <h3>Your Answer</h3>
            <div class="controls">
                <button class="control-btn" onclick="adjustPie(-1)">-</button>
                <span id="pie-user-text" style="font-size:1.2rem; font-weight:bold;">0/4</span>
                <button class="control-btn" onclick="adjustPie(1)">+</button>
            </div>
        </div>
    </div>

    <div id="pie-feedback" class="feedback-msg"></div>
    <button class="action-btn" onclick="checkPie()">Check Answer</button>
</div>

<!-- GAME 3: MISSING NUMBER -->
<div id="game-missing" class="game-container">
    <h2>Fill in the Blank</h2>
    <p class="instruction">Type the missing number to make the fractions equivalent.</p>
    
    <div class="equation-box">
        <div class="fraction">
            <span class="numerator" id="eq-n1">1</span>
            <span class="denominator" id="eq-d1">2</span>
        </div>
        <span>=</span>
        <div class="fraction">
            <span class="numerator">
                <input type="number" id="eq-input" class="fraction-input">
            </span>
            <span class="denominator" id="eq-d2">4</span>
        </div>
    </div>

    <div id="eq-feedback" class="feedback-msg"></div>
    <button class="action-btn" onclick="checkEquation()">Check Answer</button>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let currentMode = 'numberline';
    
    // Game Data Holders
    let nlData = { targetNum: 1, targetDen: 2, userNum: 0, userDen: 4 };
    let pieData = { targetNum: 1, targetDen: 2, userNum: 0, userDen: 4 };
    let eqData = { n1: 1, d1: 2, n2: null, d2: 4 };

    // Initialize on Load
    window.onload = function() {
        generateNumberLineProblem();
    };

    // --- NAVIGATION ---
    function switchMode(mode) {
        // Hide all
        document.querySelectorAll('.game-container').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        // Show specific
        document.getElementById(`game-${mode}`).classList.add('active');
        
        // Highlight button
        const btnIndex = ['numberline', 'visual', 'missing'].indexOf(mode);
        document.querySelectorAll('.nav-btn')[btnIndex].classList.add('active');

        currentMode = mode;
        
        // Init specific game
        if(mode === 'numberline') generateNumberLineProblem();
        if(mode === 'visual') generatePieProblem();
        if(mode === 'missing') generateEquationProblem();
    }

    // --- UTILS ---
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function simplify(numerator, denominator) {
        const gcd = (a, b) => b ? gcd(b, a % b) : a;
        const common = gcd(numerator, denominator);
        return [numerator / common, denominator / common];
    }

    // --- GAME 1: NUMBER LINES ---
    
    function generateNumberLineProblem() {
        const canvas = document.getElementById('nl-canvas');
        canvas.innerHTML = '';
        document.getElementById('nl-feedback').innerText = '';
        document.getElementById('nl-feedback').className = 'feedback-msg';

        // 1. Create a base fraction (e.g., 1/2, 1/3, 2/3)
        const bases = [[1,2], [1,3], [2,3], [1,4], [3,4]];
        const base = bases[getRandomInt(0, bases.length - 1)];
        
        // 2. Define Top Line (Simpler)
        nlData.targetNum = base[0];
        nlData.targetDen = base[1];

        // 3. Define Bottom Line (Multiple of Top)
        const multiplier = getRandomInt(2, 3); // e.g. 1/2 -> 2/4 or 3/6
        nlData.userDen = nlData.targetDen * multiplier;
        nlData.userNum = 0; // Reset user selection

        // Render Top Line (Static)
        canvas.appendChild(createLineHTML(nlData.targetDen, nlData.targetNum, false));
        
        // Render Bottom Line (Interactive)
        canvas.appendChild(createLineHTML(nlData.userDen, 0, true));
    }

    function createLineHTML(denominator, highlightVal, isInteractive) {
        const wrapper = document.createElement('div');
        wrapper.className = 'number-line-wrapper';
        
        const label = document.createElement('span');
        label.className = 'nl-label';
        label.innerText = isInteractive ? "Find Equivalent:" : `Reference: ${highlightVal}/${denominator}`;
        wrapper.appendChild(label);

        const line = document.createElement('div');
        line.className = 'line';
        // filled portion showing the fraction (from 0 to highlightVal)
        const fill = document.createElement('div');
        fill.className = 'fill';
        const initialPct = denominator > 0 ? (highlightVal / denominator) * 100 : 0;
        fill.style.width = `${initialPct}%`;
        line.appendChild(fill);
        
        // Create Ticks
        for(let i=0; i<=denominator; i++) {
            const tick = document.createElement('div');
            tick.className = 'tick';
            const pct = (i / denominator) * 100;
            tick.style.left = `${pct}%`;
            
            // Labels (0 and 1)
            if(i === 0 || i === denominator) {
                const tLabel = document.createElement('div');
                tLabel.className = 'tick-label';
                tLabel.innerText = i === 0 ? '0' : '1';
                tick.appendChild(tLabel);
            }

            // Interaction
            if(isInteractive) {
                tick.onclick = () => {
                    // Move Point
                    const point = wrapper.querySelector('.point');
                    point.style.left = `${pct}%`;
                    // Update filled portion to match selected tick
                    if(fill) fill.style.width = `${pct}%`;
                    nlData.userNum = i;
                };
            }

            line.appendChild(tick);
        }

        // Create Point
        const point = document.createElement('div');
        point.className = 'point';
        const startPct = (highlightVal / denominator) * 100;
        point.style.left = `${startPct}%`;
        line.appendChild(point);

        wrapper.appendChild(line);
        return wrapper;
    }

    function checkNumberLine() {
        const feedback = document.getElementById('nl-feedback');
        const val1 = nlData.targetNum / nlData.targetDen;
        const val2 = nlData.userNum / nlData.userDen;

        if (Math.abs(val1 - val2) < 0.001) {
            feedback.innerText = "Correct! Good job!";
            feedback.className = "feedback-msg correct-anim";
            setTimeout(generateNumberLineProblem, 1500);
        } else {
            feedback.innerText = `Not quite. You selected ${nlData.userNum}/${nlData.userDen}. Try again!`;
            feedback.className = "feedback-msg wrong-anim";
        }
    }


    // --- GAME 2: VISUAL PIES ---

    function generatePieProblem() {
        document.getElementById('pie-feedback').innerText = '';
        
        // Logic: Target is random simple fraction
        const bases = [[1,2], [1,3], [2,3], [1,4], [3,4], [1,5]];
        const base = bases[getRandomInt(0, bases.length - 1)];
        
        pieData.targetNum = base[0];
        pieData.targetDen = base[1];

        // User den is multiple
        const multiplier = getRandomInt(2, 3); 
        pieData.userDen = pieData.targetDen * multiplier;
        pieData.userNum = 0; // reset

        // Update UI Text
        document.getElementById('pie-ref-text').innerText = `${pieData.targetNum}/${pieData.targetDen}`;
        
        // Draw Reference Pie
        drawPie('pie-ref', pieData.targetNum, pieData.targetDen, '#4a90e2');
        
        // Draw Initial User Pie
        updateUserPieUI();
    }

    function drawPie(elementId, num, den, color) {
        const el = document.getElementById(elementId);
        const percentage = (num / den) * 100;
        // Base pie fill (colored wedge + remainder)
        el.style.background = `conic-gradient(${color} 0% ${percentage}%, #ddd ${percentage}% 100%)`;

        // Create or update a separators overlay that draws thin radial lines for each slice
        // Only add separators when denominator > 1
        if (den > 1) {
            let sep = el.querySelector('.separators');
            if (!sep) {
                sep = document.createElement('div');
                sep.className = 'separators';
                el.appendChild(sep);
            }
            const angle = 360 / den;
            // Draw a repeating-conic-gradient where a very thin black band appears at each slice boundary
            // We use a small thickness (0.6deg) for the separator to keep it crisp
            const thicknessDeg = 0.6;
            sep.style.background = `repeating-conic-gradient(transparent 0 calc(${angle}deg - ${thicknessDeg}deg), rgba(0,0,0,0.95) calc(${angle}deg - ${thicknessDeg}deg) ${angle}deg)`;
        } else {
            // remove separators if present
            const sep = el.querySelector('.separators');
            if (sep) sep.remove();
        }
    }

    function adjustPie(delta) {
        let newNum = pieData.userNum + delta;
        if(newNum >= 0 && newNum <= pieData.userDen) {
            pieData.userNum = newNum;
            updateUserPieUI();
        }
    }

    function updateUserPieUI() {
        document.getElementById('pie-user-text').innerText = `${pieData.userNum}/${pieData.userDen}`;
        drawPie('pie-user', pieData.userNum, pieData.userDen, '#f5a623');
    }

    function checkPie() {
        const feedback = document.getElementById('pie-feedback');
        const val1 = pieData.targetNum / pieData.targetDen;
        const val2 = pieData.userNum / pieData.userDen;

        if (Math.abs(val1 - val2) < 0.001) {
            feedback.innerText = "That Matches Perfectly!";
            feedback.className = "feedback-msg correct-anim";
            setTimeout(generatePieProblem, 1500);
        } else {
            feedback.innerText = "Look at the shaded areas. Make them the same size!";
            feedback.className = "feedback-msg wrong-anim";
        }
    }


    // --- GAME 3: MISSING NUMBER ---

    function generateEquationProblem() {
        document.getElementById('eq-feedback').innerText = '';
        document.getElementById('eq-input').value = '';

        const bases = [[1,2], [2,3], [3,4], [2,5], [3,5]];
        const base = bases[getRandomInt(0, bases.length - 1)];
        const multiplier = getRandomInt(2, 4);

        eqData.n1 = base[0];
        eqData.d1 = base[1];
        eqData.d2 = eqData.d1 * multiplier;
        eqData.correctAnswer = eqData.n1 * multiplier;

        document.getElementById('eq-n1').innerText = eqData.n1;
        document.getElementById('eq-d1').innerText = eqData.d1;
        document.getElementById('eq-d2').innerText = eqData.d2;
    }

    function checkEquation() {
        const userVal = parseInt(document.getElementById('eq-input').value);
        const feedback = document.getElementById('eq-feedback');

        if (userVal === eqData.correctAnswer) {
            feedback.innerText = "Excellent Math Skills!";
            feedback.className = "feedback-msg correct-anim";
            setTimeout(generateEquationProblem, 1500);
        } else {
            feedback.innerText = "Try again. Hint: How did the bottom number change?";
            feedback.className = "feedback-msg wrong-anim";
        }
    }

</script>
</body>
</html>