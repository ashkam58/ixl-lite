<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometry Jive: Angle Adventure</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrolling on the body */
        }
        /* Custom scrollbar for content area */
        #main-content-area {
            overflow-y: auto;
            max-height: calc(100vh - 8rem); /* Adjust based on header/tab height */
        }
        #main-content-area::-webkit-scrollbar {
            width: 8px;
        }
        #main-content-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #main-content-area::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #main-content-area::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Custom styles for "puffy" buttons and cards */
        .nav-button {
            transition: all 0.2s ease-in-out;
        }
        .nav-button:hover {
            background-color: #fde047; /* yellow-300 */
            color: #1e3a8a; /* blue-900 */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .nav-button.active {
            background-color: #facc15; /* yellow-400 */
            color: #1e3a8a; /* blue-900 */
            font-weight: 700;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            border-bottom: 4px solid #3b82f6; /* blue-500 */
            color: #3b82f6; /* blue-500 */
            font-weight: 700;
        }
        .practice-card {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 1px solid #d1d5db;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.2);
        }
        .btn-option {
            background-color: white;
            border: 2px solid #d1d5db;
            transition: all 0.2s ease-in-out;
        }
        .btn-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: scale(1.02);
        }
        .speech-bubble {
            position: relative;
            background: #ffffff;
            border-radius: .4em;
            border: 2px solid #2563eb;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-top-color: #2563eb;
            border-bottom: 0;
            border-left: 0;
            margin-left: -10px;
            margin-bottom: -20px;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-900">

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <nav class="w-72 h-full bg-gradient-to-b from-blue-700 to-blue-600 text-white shadow-2xl flex flex-col fixed">
            <div class="p-6 text-center">
                <h1 class="text-3xl font-bold text-yellow-300">Geometry Jive!</h1>
                <p class="text-sm text-blue-100">Angle Adventure</p>
            </div>
            <ul id="topic-nav" class="flex-1 overflow-y-auto p-4 space-y-2">
                <!-- Topics will be injected by JS -->
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 ml-72 h-screen flex flex-col">
            <!-- Header -->
            <header class="bg-white shadow-md p-6 z-10">
                <h2 id="topic-title" class="text-3xl font-bold text-blue-800">Welcome!</h2>
                <p id="topic-subtitle" class="text-gray-600">Select a topic from the left to get started.</p>
            </header>

            <!-- Learn/Practice Tabs -->
            <div class="bg-white border-b border-gray-200 px-6">
                <nav id="mode-tabs" class="flex space-x-8">
                    <button data-mode="learn" class="tab-button py-4 px-1 text-lg font-medium text-gray-500 hover:text-blue-500">
                        üéì Learn
                    </button>
                    <button data-mode="practice" class="tab-button py-4 px-1 text-lg font-medium text-gray-500 hover:text-blue-500">
                        ‚úèÔ∏è Practice
                    </button>
                </nav>
            </div>

            <!-- Content Display -->
            <div id="main-content-area" class="flex-1 p-8 bg-gray-50">
                <div id="content-container" class="max-w-4xl mx-auto">
                    <!-- Content will be injected by JS -->
                </div>
            </div>
        </main>
    </div>

    <!-- Mascot -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center space-y-2 z-20">
        <div id="mascot-tip" class="speech-bubble w-64 p-4 rounded-lg shadow-lg text-sm text-gray-800 hidden">
            Hi there! I'm Professor Protractor. Select a topic to start learning!
        </div>
        <!-- SVG Mascot: Friendly Protractor -->
        <svg id="mascot-svg" class="w-24 h-24 cursor-pointer transform hover:scale-110 transition-transform" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 80 A 40 40 0 0 1 90 80 H 10 Z" fill="#FDE047" stroke="#F59E0B" stroke-width="4"/>
            <path d="M10 80 H 90" stroke="#F59E0B" stroke-width="4"/>
            <rect x="35" y="76" width="30" height="8" fill="#FDE047" stroke="#F59E0B" stroke-width="2"/>
            <!-- Eyes -->
            <circle cx="35" cy="65" r="5" fill="white"/>
            <circle cx="35" cy="65" r="2" fill="black"/>
            <circle cx="65" cy="65" r="5" fill="white"/>
            <circle cx="65" cy="65" r="2" fill="black"/>
            <!-- Mouth -->
            <path d="M40 75 Q 50 70 60 75" stroke="black" stroke-width="2" fill="none"/>
            <!-- Protractor lines (simplified) -->
            <path d="M50 80 V 40" stroke="#F59E0B" stroke-width="1.5"/>
            <path d="M32.6 70.6 L 59.3 49.3" stroke="#F59E0B" stroke-width="1.5"/>
            <path d="M67.4 70.6 L 40.7 49.3" stroke="#F59E0B" stroke-width="1.5"/>
        </svg>
    </div>

    <!-- Modal for Feedback -->
    <div id="feedback-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div id="modal-content" class="bg-white rounded-xl shadow-2xl p-8 max-w-sm text-center transform scale-95 transition-transform">
            <h3 id="modal-title" class="text-3xl font-bold"></h3>
            <p id="modal-message" class="text-lg text-gray-700 mt-4"></p>
            <button id="modal-next-btn" class="btn-primary mt-8 py-3 px-8 rounded-full font-semibold text-lg">
                Next
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- STATE & CONSTANTS ---
            const topics = [
                { id: 'angle-vocabulary', title: 'Angle Vocabulary' },
                { id: 'angle-measures', title: 'Angle Measures' },
                { id: 'identify-angle-pairs', title: 'Identify Angle Pairs' },
                { id: 'find-angle-measures', title: 'Find Angle Measures' },
                { id: 'solve-for-variable', title: 'Solve for the Variable' },
                { id: 'angle-bisectors', title: 'Angle Bisectors' },
                { id: 'construct-bisector', title: 'Construct an Angle Bisector' },
                { id: 'construct-congruent', title: 'Construct a Congruent Angle' },
                { id: 'angle-proofs', title: 'Proofs Involving Angles' }
            ];

            let currentTopic = '';
            let currentMode = 'learn'; // 'learn' or 'practice'
            let practiceState = {}; // For quizzes, steps, etc.

            // --- DOM ELEMENTS ---
            const nav = document.getElementById('topic-nav');
            const titleEl = document.getElementById('topic-title');
            const subtitleEl = document.getElementById('topic-subtitle');
            const tabs = document.getElementById('mode-tabs');
            const contentContainer = document.getElementById('content-container');
            const mascotTip = document.getElementById('mascot-tip');
            const mascotSvg = document.getElementById('mascot-svg');
            const modal = document.getElementById('feedback-modal');
            const modalContent = document.getElementById('modal-content');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalNextBtn = document.getElementById('modal-next-btn');

            // --- INITIALIZATION ---
            function initializeApp() {
                // Populate nav
                nav.innerHTML = topics.map((topic, index) => `
                    <li>
                        <button class="nav-button w-full text-left p-4 rounded-lg" data-topic-id="${topic.id}">
                            <span class="font-bold text-lg">${index + 1}.</span> ${topic.title}
                        </button>
                    </li>
                `).join('');

                // Add event listeners
                nav.addEventListener('click', handleNavClick);
                tabs.addEventListener('click', handleTabClick);
                mascotSvg.addEventListener('click', toggleMascotTip);
                modalNextBtn.addEventListener('click', hideModal);
                
                // Set initial state
                if (topics.length > 0) {
                    setTopic(topics[0].id);
                }
                setMode('learn');
                updateMascotTip("Hi there! I'm Professor Protractor. Select a topic to start learning!");
            }

            // --- NAVIGATION & MODE SWITCHING ---

            function handleNavClick(e) {
                const button = e.target.closest('.nav-button');
                if (button) {
                    const topicId = button.dataset.topicId;
                    setTopic(topicId);
                }
            }

            function handleTabClick(e) {
                const button = e.target.closest('.tab-button');
                if (button) {
                    const mode = button.dataset.mode;
                    setMode(mode);
                }
            }

            function setTopic(topicId) {
                currentTopic = topicId;
                const topic = topics.find(t => t.id === topicId);

                // Update UI
                titleEl.textContent = topic.title;
                subtitleEl.textContent = `Learn and practice concepts for ${topic.title}.`;
                
                // Update active nav button
                nav.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.topicId === topicId);
                });

                updateMascotTip(getMascotTip(topicId));
                renderContent();
            }

            function setMode(mode) {
                currentMode = mode;

                // Update active tab
                tabs.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === mode);
                });

                renderContent();
            }

            function toggleMascotTip() {
                mascotTip.classList.toggle('hidden');
            }

            function updateMascotTip(text) {
                mascotTip.textContent = text;
                mascotTip.classList.remove('hidden');
                // Hide after a few seconds
                setTimeout(() => {
                    mascotTip.classList.add('hidden');
                }, 4000);
            }
            
            function getMascotTip(topicId) {
                const tips = {
                    'angle-vocabulary': "It all starts with the basics! Knowing your 'acute' from your 'obtuse' is key.",
                    'angle-measures': "A protractor is a geometry student's best friend! Remember, a full circle is 360¬∞.",
                    'identify-angle-pairs': "Look for the relationships! Are they neighbors? Are they opposites? This tells you a lot.",
                    'find-angle-measures': "This is like being a detective! Use the clues from angle pairs to find the missing number.",
                    'solve-for-variable': "Don't be scared by 'x'! It's just algebra meeting geometry. Set up your equation and solve.",
                    'angle-bisectors': "'Bi' means two and 'sect' means cut. A bisector cuts an angle into two equal pieces!",
                    'construct-bisector': "This is classic geometry. All you need is a compass and a straightedge. Let's learn the steps!",
                    'construct-congruent': "Making a perfect copy! This skill is fundamental. Follow the steps carefully.",
                    'angle-proofs': "This is the fun part! Using logic to prove something is true. We start with 'Given' and end with 'Prove'."
                };
                return tips[topicId] || "Let's get learning!";
            }

            // --- CONTENT RENDERING ---

            function renderContent() {
                practiceState = { score: 0, currentQuestion: 0, step: 0 }; // Reset practice state
                let html = '';

                if (currentMode === 'learn') {
                    html = getLearnContent(currentTopic);
                } else {
                    html = getPracticeContent(currentTopic);
                }
                
                contentContainer.innerHTML = html;
                
                // Add listeners for any new buttons
                addPracticeListeners();
            }

            function getLearnContent(topicId) {
                switch (topicId) {
                    case 'angle-vocabulary':
                        return `
                            <div class="space-y-6">
                                ${createLearnCard('Acute Angle', 'An angle that measures less than 90¬∞.', createAngleSVG(45, 'blue'))}
                                ${createLearnCard('Right Angle', 'An angle that measures exactly 90¬∞.', createAngleSVG(90, 'green'))}
                                ${createLearnCard('Obtuse Angle', 'An angle that measures more than 90¬∞ but less than 180¬∞.', createAngleSVG(135, 'orange'))}
                                ${createLearnCard('Straight Angle', 'An angle that measures exactly 180¬∞ (a straight line).', createAngleSVG(180, 'red'))}
                            </div>
                        `;
                    case 'angle-measures':
                        return `
                            <div class="space-y-6">
                                ${createLearnCard('Measuring Angles', 'We measure angles in degrees (¬∞). A full circle has 360¬∞. We use a tool called a protractor to measure angles.', 
                                    `<div class="w-full flex justify-center p-4 bg-gray-100 rounded-lg">
                                        <!-- SVG of a protractor measuring an angle -->
                                        <svg width="250" height="150" viewBox="0 0 250 150">
                                            <path d="M 25 125 L 225 125 L 125 125 L 180 50" stroke="#3b82f6" stroke-width="3" fill="none" />
                                            <text x="185" y="50" fill="#3b82f6" font-size="16">60¬∞</text>
                                            <path d="M 25 125 A 100 100 0 0 1 225 125" stroke="#888" stroke-width="2" fill="none" stroke-dasharray="2 2"/>
                                            <path d="M 125 125 L 125 25" stroke="#888" stroke-width="1" />
                                            <text x="117" y="20" fill="#888" font-size="12">90</text>
                                            <path d="M 125 125 L 206 75" stroke="#888" stroke-width="1" />
                                            <text x="210" y="75" fill="#888" font-size="12">30</text>
                                            <path d="M 125 125 L 180 50" stroke="#888" stroke-width="1" />
                                            <text x="185" y="45" fill="#888" font-size="12">60</text>
                                            <path d="M 25 125 H 225" stroke="black" stroke-width="2" />
                                            <circle cx="125" cy="125" r="4" fill="black"/>
                                        </svg>
                                    </div>`
                                )}
                                ${createLearnCard('How to Use a Protractor', `
                                    <ol class="list-decimal list-inside space-y-2">
                                        <li>Place the center hole of the protractor on the <strong>vertex</strong> (the corner) of the angle.</li>
                                        <li>Line up one of the angle's rays with the 0¬∞ line on the protractor.</li>
                                        <li>Read the number where the second ray crosses the protractor's scale. Be sure to use the correct scale (inside or outside numbers)!</li>
                                    </ol>
                                `)}
                            </div>
                        `;
                    case 'identify-angle-pairs':
                        return `
                            <div class="grid md:grid-cols-2 gap-6">
                                ${createLearnCard('Complementary', 'Two angles whose measures add up to 90¬∞.', createAnglePairSVG('complementary'))}
                                ${createLearnCard('Supplementary', 'Two angles whose measures add up to 180¬∞.', createAnglePairSVG('supplementary'))}
                                ${createLearnCard('Adjacent', 'Two angles that share a common vertex and a common side, but do not overlap.', createAnglePairSVG('adjacent'))}
                                ${createLearnCard('Vertical', 'A pair of opposite angles formed by two intersecting lines. Vertical angles are always congruent (equal).', createAnglePairSVG('vertical'))}
                                ${createLearnCard('Congruent', 'Angles that have the same measure.', createAnglePairSVG('congruent'))}
                            </div>
                        `;
                    case 'find-angle-measures':
                         return `
                            <div class="space-y-6">
                                ${createLearnCard('Finding Complementary Angles', 'If you know one angle is 30¬∞, its complement is 90¬∞ - 30¬∞ = 60¬∞.', createAnglePairSVG('complementary', 30, 60))}
                                ${createLearnCard('Finding Supplementary Angles', 'If you know one angle is 110¬∞, its supplement is 180¬∞ - 110¬∞ = 70¬∞.', createAnglePairSVG('supplementary', 110, 70))}
                                ${createLearnCard('Finding Vertical Angles', 'If two lines intersect and one angle is 125¬∞, the vertical angle opposite it is also 125¬∞.', createAnglePairSVG('vertical', 125, 125))}
                                ${createLearnCard('Finding Adjacent Angles (on a line)', 'If two adjacent angles form a straight line (180¬∞), and one is 50¬∞, the other is 180¬∞ - 50¬∞ = 130¬∞.', createAnglePairSVG('supplementary', 50, 130))}
                            </div>
                        `;
                    case 'solve-for-variable':
                        return `
                            <div class="space-y-6">
                                ${createLearnCard('Using Algebra in Geometry', 'Often, angle measures are given as algebraic expressions. You must use the angle pair relationships to set up an equation and solve for x.', '')}
                                ${createLearnCard('Example: Supplementary Angles', `
                                    <p class="mb-4">Two adjacent angles on a straight line have measures of (2x + 10)¬∞ and (3x + 20)¬∞.</p>
                                    <ol class="list-decimal list-inside space-y-2 text-left">
                                        <li><strong>Identify Relationship:</strong> They form a straight line, so they are supplementary (add to 180¬∞).</li>
                                        <li><strong>Set up Equation:</strong> (2x + 10) + (3x + 20) = 180</li>
                                        <li><strong>Combine Like Terms:</strong> 5x + 30 = 180</li>
                                        <li><strong>Solve for x:</strong>
                                            <ul class="list-disc list-inside ml-4">
                                                <li>5x = 180 - 30</li>
                                                <li>5x = 150</li>
                                                <li>x = 30</li>
                                            </ul>
                                        </li>
                                        <li><strong>Find Angle Measures:</strong>
                                            <ul class="list-disc list-inside ml-4">
                                                <li>Angle 1 = 2(30) + 10 = 60 + 10 = 70¬∞</li>
                                                <li>Angle 2 = 3(30) + 20 = 90 + 20 = 110¬∞</li>
                                                <li>Check: 70¬∞ + 110¬∞ = 180¬∞. Correct!</li>
                                            </ul>
                                        </li>
                                    </ol>
                                `, createAnglePairSVG('supplementary', '(2x+10)¬∞', '(3x+20)¬∞'))}
                            </div>
                        `;
                    case 'angle-bisectors':
                        return `
                            <div class="space-y-6">
                                ${createLearnCard('What is an Angle Bisector?', 'An angle bisector is a ray that divides an angle into two adjacent, congruent angles (two equal halves).', createAnglePairSVG('bisector'))}
                                ${createLearnCard('Example', `
                                    <p>If ray BD bisects ‚à†ABC and the measure of ‚à†ABC is 80¬∞, then:</p>
                                    <ul class="list-disc list-inside ml-4 mt-2">
                                        <li>m‚à†ABD = m‚à†DBC</li>
                                        <li>m‚à†ABD = 80¬∞ / 2 = 40¬∞</li>
                                        <li>m‚à†DBC = 80¬∞ / 2 = 40¬∞</li>
                                    </ul>
                                `, createAnglePairSVG('bisector', '40¬∞', '40¬∞'))}
                                ${createLearnCard('Solving with Algebra', `
                                    <p>If ray BD bisects ‚à†ABC, and m‚à†ABD = (3x + 10)¬∞ and m‚à†DBC = (5x - 2)¬∞:</p>
                                    <ol class="list-decimal list-inside space-y-2 text-left mt-2">
                                        <li><strong>Identify Relationship:</strong> Since it's a bisector, the two parts are equal.</li>
                                        <li><strong>Set up Equation:</strong> 3x + 10 = 5x - 2</li>
                                        <li><strong>Solve for x:</strong>
                                            <ul class="list-disc list-inside ml-4">
                                                <li>10 + 2 = 5x - 3x</li>
                                                <li>12 = 2x</li>
                                                <li>x = 6</li>
                                            </ul>
                                        </li>
                                    </ol>
                                `, createAnglePairSVG('bisector', '(3x+10)¬∞', '(5x-2)¬∞'))}
                            </div>
                        `;
                    case 'construct-bisector':
                        return `
                            <h3 class="text-2xl font-bold text-blue-700 mb-4">How to Construct an Angle Bisector</h3>
                            <p class="text-lg text-gray-700 mb-6">Follow these steps using a compass and a straightedge (like a ruler, but just for drawing lines).</p>
                            <div id="construction-steps" class="space-y-4">
                                <!-- Steps will be injected by JS -->
                            </div>
                        `;
                    case 'construct-congruent':
                         return `
                            <h3 class="text-2xl font-bold text-blue-700 mb-4">How to Construct a Congruent Angle</h3>
                            <p class="text-lg text-gray-700 mb-6">Follow these steps to copy an angle perfectly.</p>
                            <div id="construction-steps" class="space-y-4">
                                <!-- Steps will be injected by JS -->
                            </div>
                        `;
                    case 'angle-proofs':
                        return `
                            <h3 class="text-2xl font-bold text-blue-700 mb-4">Introduction to Angle Proofs</h3>
                            <p class="text-lg text-gray-700 mb-6">A proof is a logical argument that shows a statement is true. We use "Given" information, definitions, and theorems to prove a "Conclusion". A common format is the two-column proof.</p>
                            
                            ${createLearnCard('Key Definitions & Properties', `
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>Definition of Congruent:</strong> If m‚à†A = m‚à†B, then ‚à†A ‚âÖ ‚à†B.</li>
                                    <li><strong>Definition of Bisector:</strong> If ray BX bisects ‚à†ABC, then ‚à†ABX ‚âÖ ‚à†XBC.</li>
                                    <li><strong>Definition of Supplementary:</strong> If two angles form a linear pair, they are supplementary (add to 180¬∞).</li>
                                    <li><strong>Substitution Property:</strong> If a = b and b = c, then a = c.</li>
                                </ul>
                            `)}
                            
                            ${createLearnCard('Example: Vertical Angles Theorem', `
                                <p class="mb-4">Let's prove that vertical angles are congruent.</p>
                                <p><strong>Given:</strong> ‚à†1 and ‚à†2 are vertical angles.</p>
                                <p class="mb-4"><strong>Prove:</strong> ‚à†1 ‚âÖ ‚à†2</p>
                                <div class="w-full my-4 flex justify-center">${createAnglePairSVG('vertical-proof')}</div>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="bg-blue-100">
                                            <th class="border p-2 font-bold">Statements</th>
                                            <th class="border p-2 font-bold">Reasons</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="border p-2">1. ‚à†1 and ‚à†3 form a linear pair.</td>
                                            <td class="border p-2">1. Definition of a linear pair.</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">2. ‚à†1 and ‚à†3 are supplementary.</td>
                                            <td class="border p-2">2. Linear Pair Postulate.</td>
                                        </tr>
                                         <tr>
                                            <td class="border p-2">3. m‚à†1 + m‚à†3 = 180¬∞</td>
                                            <td class="border p-2">3. Definition of supplementary angles.</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">4. ‚à†2 and ‚à†3 form a linear pair.</td>
                                            <td class="border p-2">4. Definition of a linear pair.</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">5. ‚à†2 and ‚à†3 are supplementary.</td>
                                            <td class="border p-2">5. Linear Pair Postulate.</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">6. m‚à†2 + m‚à†3 = 180¬∞</td>
                                            <td class="border p-2">6. Definition of supplementary angles.</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">7. m‚à†1 + m‚à†3 = m‚à†2 + m‚à†3</td>
                                            <td class="border p-2">7. Substitution Property (both equal 180¬∞).</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">8. m‚à†1 = m‚à†2</td>
                                            <td class="border p-2">8. Subtraction Property (subtract m‚à†3 from both sides).</td>
                                        </tr>
                                        <tr>
                                            <td class="border p-2">9. ‚à†1 ‚âÖ ‚à†2</td>
                                            <td class="border p-2">9. Definition of congruent angles.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            `)}
                        `;
                    default:
                        return `<p>Coming soon!</p>`;
                }
            }

            function getPracticeContent(topicId) {
                switch (topicId) {
                    case 'angle-vocabulary':
                        return `
                            <div class="practice-card rounded-xl shadow-lg p-8 text-center">
                                <h3 class="text-2xl font-bold text-blue-700 mb-2">Identify the Angle!</h3>
                                <p class="text-gray-600 mb-6">What type of angle is shown below?</p>
                                <div id="practice-display" class="w-full flex justify-center mb-6">
                                    <!-- SVG will be injected -->
                                </div>
                                <div id="practice-options" class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                                    <!-- Options will be injected -->
                                </div>
                                <div id="practice-feedback" class="mt-6 text-lg font-semibold"></div>
                            </div>
                        `;
                    case 'identify-angle-pairs':
                    case 'find-angle-measures':
                    case 'solve-for-variable':
                    case 'angle-bisectors':
                         return `
                            <div class="practice-card rounded-xl shadow-lg p-8 text-center">
                                <h3 class="text-2xl font-bold text-blue-700 mb-2" id="practice-title">Practice Drill!</h3>
                                <p class="text-gray-600 mb-6" id="practice-prompt">Find the missing value.</p>
                                <div id="practice-display" class="w-full flex justify-center mb-6 p-4 bg-white rounded-lg shadow-inner">
                                    <!-- SVG will be injected -->
                                </div>
                                <div id="practice-input-area" class="mt-4">
                                    <!-- Input/options will be injected -->
                                </div>
                                <button id="check-answer-btn" class="btn-primary mt-6 py-2 px-6 rounded-full font-semibold">Check Answer</button>
                                <div id="practice-feedback" class="mt-6 text-lg font-semibold"></div>
                                <button id="next-question-btn" class="btn-primary mt-6 py-2 px-6 rounded-full font-semibold hidden">Next Question</button>
                            </div>
                        `;
                    case 'angle-proofs':
                        return `
                            <div class="practice-card rounded-xl shadow-lg p-8">
                                <h3 class="text-2xl font-bold text-blue-700 mb-4 text-center">Fill in the Proof!</h3>
                                <p class="text-gray-600 mb-6 text-center">Complete the two-column proof by selecting the correct reason for each step.</p>
                                <p class="mb-2"><strong>Given:</strong> ‚à†1 and ‚à†2 are complementary. ‚à†1 ‚âÖ ‚à†3.</p>
                                <p class="mb-4"><strong>Prove:</strong> ‚à†3 and ‚à†2 are complementary.</p>
                                <div id="practice-display" class="w-full flex justify-center mb-6 p-4 bg-white rounded-lg shadow-inner">
                                    <svg width="200" height="150" viewBox="0 0 200 150">
                                        <path d="M 20 130 L 180 130" stroke="black" stroke-width="2"/>
                                        <path d="M 20 130 L 100 20" stroke="black" stroke-width="2"/>
                                        <path d="M 100 20 L 100 130" stroke="black" stroke-width="2" stroke-dasharray="4 4"/>
                                        <path d="M 180 130 L 100 20" stroke="black" stroke-width="2"/>
                                        <path d="M 100 130 A 20 20 0 0 1 83 113" stroke="#f87171" fill="none" stroke-width="2"/>
                                        <text x="80" y="110" fill="#f87171" font-size="16">1</text>
                                        <path d="M 100 130 A 30 30 0 0 0 126 112" stroke="#3b82f6" fill="none" stroke-width="2"/>
                                        <text x="125" y="115" fill="#3b82f6" font-size="16">2</text>
                                        <path d="M 80 40 A 20 20 0 0 1 100 20" stroke="#f87171" fill="none" stroke-width="2"/>
                                        <text x="70" y="45" fill="#f87171" font-size="16">3</text>
                                    </svg>
                                </div>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="bg-blue-100">
                                            <th class="border p-2 font-bold">Statements</th>
                                            <th class="border p-2 font-bold">Reasons</th>
                                        </tr>
                                    </thead>
                                    <tbody id="proof-table-body">
                                        <!-- Proof steps injected by JS -->
                                    </tbody>
                                </table>
                                <div id="practice-feedback" class="mt-6 text-lg font-semibold text-center"></div>
                            </div>
                        `;
                    case 'construct-bisector':
                    case 'construct-congruent':
                        return `
                            <div class="practice-card rounded-xl shadow-lg p-8 text-center">
                                <h3 class="text-2xl font-bold text-blue-700 mb-2">Order the Steps!</h3>
                                <p class="text-gray-600 mb-6">Drag and drop the steps for this construction into the correct order.</p>
                                <div class="flex flex-col md:flex-row gap-6">
                                    <div class="flex-1 bg-white p-4 rounded-lg shadow-inner">
                                        <h4 class="font-bold mb-2">Steps (Drag them)</h4>
                                        <ul id="draggable-steps" class="space-y-2 min-h-[200px]">
                                            <!-- Draggable steps injected by JS -->
                                        </ul>
                                    </div>
                                    <div class="flex-1 bg-blue-50 p-4 rounded-lg shadow-inner">
                                        <h4 class="font-bold mb-2">Correct Order (Drop here)</h4>
                                        <ul id="droppable-area" class="space-y-2 min-h-[200px] border-2 border-dashed border-blue-300 rounded-lg p-2">
                                            <!-- Dropped steps will appear here -->
                                        </ul>
                                    </div>
                                </div>
                                <button id="check-order-btn" class="btn-primary mt-6 py-2 px-6 rounded-full font-semibold">Check My Order</button>
                                <div id="practice-feedback" class="mt-6 text-lg font-semibold"></div>
                            </div>
                        `;
                    default:
                        return `
                            <div class="practice-card rounded-xl shadow-lg p-8 text-center">
                                <h3 class="text-2xl font-bold text-blue-700 mb-2">Coming Soon!</h3>
                                <p class="text-gray-600">Practice drills for this topic are being built!</p>
                                <div class="mt-6">üöß üõ†Ô∏è üöß</div>
                            </div>
                        `;
                }
            }
            
            function createLearnCard(title, text, visual = '') {
                return `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="p-6">
                            <h3 class="text-2xl font-bold text-blue-700 mb-3">${title}</h3>
                            <div class="text-gray-700 text-lg space-y-2">${text}</div>
                        </div>
                        ${visual ? `<div class="p-6 bg-gray-50 flex justify-center">${visual}</div>` : ''}
                    </div>
                `;
            }

            // --- SVG HELPERS ---
            function createAngleSVG(deg, color = 'currentColor') {
                const rad = deg * (Math.PI / 180);
                const x = 50 + 40 * Math.cos(rad);
                const y = 90 - 40 * Math.sin(rad);
                const largeArc = deg > 180 ? 1 : 0;
                
                let path = `M 50 90 L 90 90 A 40 40 0 ${largeArc} 0 ${x} ${y} Z`;
                if (deg === 180) {
                     path = `M 10 90 L 90 90 M 10 90 A 40 40 0 0 1 90 90`;
                } else if (deg === 90) {
                    path = `M 50 90 L 90 90 M 50 90 L 50 50 M 80 90 L 80 60 L 50 60`; // L-shape for right angle
                }
                
                return `
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <line x1="50" y1="90" x2="90" y2="90" stroke="#888" stroke-width="2" />
                        <line x1="50" y1="90" x2="${x}" y2="${y}" stroke="#888" stroke-width="2" />
                        <path d="${path}" fill="${color}" fill-opacity="0.3" stroke="${color}" stroke-width="1.5" />
                        <text x="60" y="75" font-size="12" fill="${color}">${deg}¬∞</text>
                    </svg>
                `;
            }

            function createAnglePairSVG(type, val1 = '', val2 = '') {
                // SVGs for complex pairs
                switch (type) {
                    case 'complementary':
                        return `
                        <svg width="150" height="150" viewBox="0 0 100 100">
                            <line x1="50" y1="90" x2="90" y2="90" stroke="#888" stroke-width="2" />
                            <line x1="50" y1="90" x2="50" y2="50" stroke="#888" stroke-width="2" />
                            <line x1="50" y1="90" x2="70" y2="60" stroke="#888" stroke-width="2" />
                            <path d="M 50 90 L 70 90 L 70 70 Z" fill="#3b82f6" fill-opacity="0.1" stroke="#3b82f6" stroke-width="1" />
                            <path d="M 50 90 L 70 60 A 20 20 0 0 0 65 85 Z" fill="#f87171" fill-opacity="0.3" />
                            <text x="75" y="75" font-size="10">${val1 || 'Angle 1'}</text>
                            <path d="M 50 90 L 50 70 A 20 20 0 0 1 70 60 Z" fill="#3b82f6" fill-opacity="0.3" />
                            <text x="55" y="65" font-size="10">${val2 || 'Angle 2'}</text>
                        </svg>`;
                    case 'supplementary':
                        return `
                        <svg width="200" height="100" viewBox="0 0 150 100">
                            <line x1="10" y1="80" x2="140" y2="80" stroke="#888" stroke-width="2" />
                            <line x1="75" y1="80" x2="100" y2="40" stroke="#888" stroke-width="2" />
                            <circle cx="75" cy="80" r="3" fill="black" />
                            <path d="M 75 80 L 100 80 A 25 25 0 0 0 100 40 Z" fill="#f87171" fill-opacity="0.3" />
                            <text x="95" y="70" font-size="10">${val1 || 'Angle 1'}</text>
                            <path d="M 75 80 L 50 80 A 25 25 0 0 1 100 40 Z" fill="#3b82f6" fill-opacity="0.3" />
                            <text x="50" y="70" font-size="10">${val2 || 'Angle 2'}</text>
                        </svg>`;
                    case 'adjacent':
                        // Same as supplementary for a good visual
                        return createAnglePairSVG('supplementary', 'Angle 1', 'Angle 2');
                    case 'vertical':
                        return `
                        <svg width="150" height="150" viewBox="0 0 100 100">
                            <line x1="20" y1="20" x2="80" y2="80" stroke="#888" stroke-width="2" />
                            <line x1="20" y1="80" x2="80" y2="20" stroke="#888" stroke-width="2" />
                            <path d="M 50 50 L 60 40 A 20 20 0 0 0 40 40 Z" fill="#f87171" fill-opacity="0.3" />
                            <text x="50" y="35" font-size="10">${val1 || 'A'}</text>
                            <path d="M 50 50 L 60 60 A 20 20 0 0 1 40 60 Z" fill="#f87171" fill-opacity="0.3" />
                            <text x="50" y="75" font-size="10">${val2 || 'A'}</text>
                        </svg>`;
                    case 'vertical-proof':
                         return `
                        <svg width="150" height="150" viewBox="0 0 100 100">
                            <line x1="20" y1="20" x2="80" y2="80" stroke="#888" stroke-width="2" />
                            <line x1="20" y1="80" x2="80" y2="20" stroke="#888" stroke-width="2" />
                            <text x="45" y="35" font-size="14" fill="#f87171">1</text>
                            <text x="60" y="45" font-size="14" fill="#3b82f6">3</text>
                            <text x="45" y="75" font-size="14" fill="#f59e0b">2</text>
                        </svg>`;
                    case 'congruent':
                        return `
                        <svg width="200" height="100" viewBox="0 0 200 100">
                            ${createAngleSVG(45, '#3b82f6').replace('<svg', '<g transform="translate(0, 0)"').replace('</svg>', '</g>')}
                            ${createAngleSVG(45, '#3b82f6').replace('<svg', '<g transform="translate(100, 0)"').replace('</svg>', '</g>')}
                        </svg>`;
                    case 'bisector':
                         return `
                        <svg width="150" height="150" viewBox="0 0 100 100">
                            <line x1="50" y1="90" x2="90" y2="90" stroke="#888" stroke-width="2" />
                            <line x1="50" y1="90" x2="50" y2="50" stroke="#888" stroke-width="2" />
                            <line x1="50" y1="90" x2="70" y2="60" stroke="#f87171" stroke-width="3" stroke-dasharray="4 4" />
                            <path d="M 50 90 L 70 90 A 20 20 0 0 0 70 60 Z" fill="#3b82f6" fill-opacity="0.3" />
                            <text x="75" y="75" font-size="10">${val1 || 'A'}</text>
                            <path d="M 50 90 L 50 70 A 20 20 0 0 1 70 60 Z" fill="#3b82f6" fill-opacity="0.3" />
                            <text x="55" y="65" font-size="10">${val2 || 'A'}</text>
                            <text x="35" y="55" font-size="10">‚à†ABC</text>
                            <text x="75" y="55" font-size="10">Ray BD</text>
                        </svg>`;
                }
            }
            
            // --- PRACTICE & QUIZ LOGIC ---
            
            function addPracticeListeners() {
                // General
                const checkBtn = document.getElementById('check-answer-btn');
                if (checkBtn) checkBtn.addEventListener('click', checkNumericAnswer);
                
                const nextBtn = document.getElementById('next-question-btn');
                if (nextBtn) nextBtn.addEventListener('click', () => renderContent()); // Simple restart
                
                // Specific init functions
                if (currentMode === 'practice') {
                    switch (currentTopic) {
                        case 'angle-vocabulary':
                            initVocabQuiz();
                            break;
                        case 'identify-angle-pairs':
                            initAnglePairQuiz();
                            break;
                        case 'find-angle-measures':
                            initFindMeasureQuiz();
                            break;
                        case 'solve-for-variable':
                            initSolveForXQuiz();
                            break;
                        case 'angle-bisectors':
                            initBisectorQuiz();
                            break;
                        case 'angle-proofs':
                            initProofQuiz();
                            break;
                        case 'construct-bisector':
                            initConstructionDragDrop('bisector');
                            break;
                        case 'construct-congruent':
                            initConstructionDragDrop('congruent');
                            break;
                    }
                } else {
                     // Learn mode construction steps
                    if (currentTopic === 'construct-bisector') {
                        initConstructionLearn('bisector');
                    }
                    if (currentTopic === 'construct-congruent') {
                        initConstructionLearn('congruent');
                    }
                }
            }
            
            // --- Quiz Initializers ---
            
            function initVocabQuiz() {
                const questions = [
                    { deg: 45, type: 'Acute', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                    { deg: 90, type: 'Right', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                    { deg: 135, type: 'Obtuse', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                    { deg: 180, type: 'Straight', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                    { deg: 88, type: 'Acute', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                    { deg: 92, type: 'Obtuse', options: ['Acute', 'Obtuse', 'Right', 'Straight'] },
                ];
                practiceState.questions = shuffle(questions);
                loadVocabQuestion();
            }
            
            function loadVocabQuestion() {
                const q = practiceState.questions[practiceState.currentQuestion];
                if (!q) {
                    showFinalScore('vocab');
                    return;
                }
                
                document.getElementById('practice-display').innerHTML = createAngleSVG(q.deg, '#3b82f6');
                const optionsHtml = q.options.map(opt => 
                    `<button class="btn-option p-4 rounded-lg font-semibold text-lg" data-answer="${opt}">${opt}</button>`
                ).join('');
                document.getElementById('practice-options').innerHTML = optionsHtml;
                
                document.getElementById('practice-options').querySelectorAll('.btn-option').forEach(btn => {
                    btn.addEventListener('click', (e) => checkVocabAnswer(e.target.dataset.answer));
                });
                
                document.getElementById('practice-feedback').innerHTML = '';
            }
            
            function checkVocabAnswer(answer) {
                const q = practiceState.questions[practiceState.currentQuestion];
                const feedbackEl = document.getElementById('practice-feedback');
                
                if (answer === q.type) {
                    practiceState.score++;
                    feedbackEl.innerHTML = `<span class="text-green-600">Correct! ${q.deg}¬∞ is an ${q.type} angle.</span>`;
                    showModal('Correct!', `That's right! ${q.deg}¬∞ is an ${q.type} angle.`, true);
                } else {
                    feedbackEl.innerHTML = `<span class="text-red-600">Not quite! That's an ${q.type} angle.</span>`;
                    showModal('Not quite!', `A ${q.deg}¬∞ angle is an ${q.type} angle. You chose ${answer}.`, false);
                }
                
                practiceState.currentQuestion++;
                modalNextBtn.onclick = () => {
                    hideModal();
                    loadVocabQuestion();
                };
            }
            
            function initAnglePairQuiz() {
                const questions = [
                    { type: 'complementary', svg: createAnglePairSVG('complementary'), answer: 'Complementary' },
                    { type: 'supplementary', svg: createAnglePairSVG('supplementary'), answer: 'Supplementary' },
                    { type: 'vertical', svg: createAnglePairSVG('vertical'), answer: 'Vertical' },
                    { type: 'adjacent', svg: createAnglePairSVG('adjacent'), answer: 'Adjacent' },
                ];
                practiceState.questions = shuffle(questions);
                practiceState.options = ['Complementary', 'Supplementary', 'Vertical', 'Adjacent', 'Congruent'];
                loadAnglePairQuestion();
            }
            
            function loadAnglePairQuestion() {
                const q = practiceState.questions[practiceState.currentQuestion];
                if (!q) {
                    showFinalScore('pair');
                    return;
                }
                
                document.getElementById('practice-title').textContent = "Identify the Angle Pair!";
                document.getElementById('practice-prompt').textContent = "What is the relationship between the marked angles?";
                document.getElementById('practice-display').innerHTML = q.svg;
                
                const optionsHtml = practiceState.options.map(opt => 
                    `<button class="btn-option p-4 rounded-lg font-semibold text-lg" data-answer="${opt}">${opt}</button>`
                ).join('');
                document.getElementById('practice-input-area').innerHTML = `
                    <div class="grid grid-cols-2 gap-4 max-w-lg mx-auto">
                        ${optionsHtml}
                    </div>
                `;
                
                document.getElementById('practice-input-area').querySelectorAll('.btn-option').forEach(btn => {
                    btn.addEventListener('click', (e) => checkAnglePairAnswer(e.target.dataset.answer));
                });
                
                document.getElementById('check-answer-btn').style.display = 'none';
                document.getElementById('next-question-btn').style.display = 'none';
                document.getElementById('practice-feedback').innerHTML = '';
            }

            function checkAnglePairAnswer(answer) {
                const q = practiceState.questions[practiceState.currentQuestion];
                const correct = answer === q.answer;
                
                if (correct) {
                    practiceState.score++;
                    showModal('Correct!', `That's a ${q.answer} pair!`, true);
                } else {
                    showModal('Not quite!', `That's a ${q.answer} pair. You chose ${answer}.`, false);
                }
                
                practiceState.currentQuestion++;
                modalNextBtn.onclick = () => {
                    hideModal();
                    loadAnglePairQuestion();
                };
            }
            
            function initFindMeasureQuiz() {
                const questions = [
                    { type: 'complementary', angle: 30, answer: 60, prompt: 'Find the complement of a 30¬∞ angle.' },
                    { type: 'supplementary', angle: 110, answer: 70, prompt: 'Find the supplement of a 110¬∞ angle.' },
                    { type: 'vertical', angle: 75, answer: 75, prompt: 'An angle measures 75¬∞. What is the measure of its vertical angle?' },
                    { type: 'supplementary', angle: 45, answer: 135, prompt: 'Two adjacent angles form a straight line. One is 45¬∞. What is the other?' },
                ];
                practiceState.questions = shuffle(questions);
                loadNumericQuestion('Find the Missing Measure', 'Enter the correct angle measure in degrees.');
            }
            
            function initSolveForXQuiz() {
                 const questions = [
                    { type: 'supplementary', expr1: '2x + 10', expr2: '3x + 20', answer: 30, prompt: `Two supplementary angles are (2x + 10)¬∞ and (3x + 20)¬∞. Find the value of x.` },
                    { type: 'complementary', expr1: 'x + 5', expr2: '2x + 1', answer: 28, prompt: `Two complementary angles are (x + 5)¬∞ and (2x + 1)¬∞. Find the value of x.` },
                    { type: 'vertical', expr1: '5x - 15', expr2: '3x + 5', answer: 10, prompt: `Two vertical angles are (5x - 15)¬∞ and (3x + 5)¬∞. Find the value of x.` },
                ];
                practiceState.questions = shuffle(questions);
                loadNumericQuestion('Solve for x', 'Find the value of x based on the description.');
            }
            
             function initBisectorQuiz() {
                 const questions = [
                    { type: 'find_half', angle: 70, answer: 35, prompt: 'An angle bisector splits a 70¬∞ angle. What is the measure of one of the new angles?' },
                    { type: 'find_whole', angle: 25, answer: 50, prompt: 'An angle bisector creates two 25¬∞ angles. What was the measure of the original angle?' },
                    { type: 'algebra', expr1: '3x + 10', expr2: '5x - 2', answer: 6, prompt: 'A bisector creates two angles, (3x + 10)¬∞ and (5x - 2)¬∞. Find x.' },
                ];
                practiceState.questions = shuffle(questions);
                loadNumericQuestion('Angle Bisector Problems', 'Read the problem and find the missing value.');
            }

            function loadNumericQuestion(title, defaultPrompt) {
                const q = practiceState.questions[practiceState.currentQuestion];
                if (!q) {
                    showFinalScore('numeric');
                    return;
                }
                
                document.getElementById('practice-title').textContent = title;
                document.getElementById('practice-prompt').textContent = q.prompt || defaultPrompt;
                
                // Show a visual if available
                const display = document.getElementById('practice-display');
                display.innerHTML = '';
                if(q.type === 'supplementary') display.innerHTML = createAnglePairSVG('supplementary', q.expr1 || '', q.expr2 || '');
                if(q.type === 'complementary') display.innerHTML = createAnglePairSVG('complementary', q.expr1 || '', q.expr2 || '');
                if(q.type === 'vertical') display.innerHTML = createAnglePairSVG('vertical', q.expr1 || '', q.expr2 || '');
                if(q.type === 'find_half' || q.type === 'find_whole' || q.type === 'algebra') display.innerHTML = createAnglePairSVG('bisector', q.expr1 || '', q.expr2 || '');
                
                document.getElementById('practice-input-area').innerHTML = `
                    <input id="numeric-answer" type="number" class="text-2xl p-3 w-48 text-center rounded-lg border-2 border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="Your Answer">
                `;
                
                document.getElementById('check-answer-btn').style.display = 'inline-block';
                document.getElementById('next-question-btn').style.display = 'none';
                document.getElementById('practice-feedback').innerHTML = '';
            }

            function checkNumericAnswer() {
                const q = practiceState.questions[practiceState.currentQuestion];
                const input = document.getElementById('numeric-answer');
                const answer = parseFloat(input.value);
                const feedbackEl = document.getElementById('practice-feedback');

                if (answer === q.answer) {
                    practiceState.score++;
                    feedbackEl.innerHTML = `<span class="text-green-600">Correct! The answer is ${q.answer}.</span>`;
                    showModal('Correct!', `Great job! The answer is ${q.answer}.`, true);
                } else {
                    feedbackEl.innerHTML = `<span class="text-red-600">Not quite! The correct answer is ${q.answer}.</span>`;
                    showModal('Not quite!', `The correct answer was ${q.answer}. You entered ${answer}.`, false);
                }
                
                practiceState.currentQuestion++;
                modalNextBtn.onclick = () => {
                    hideModal();
                    loadNumericQuestion(document.getElementById('practice-title').textContent, '');
                };
            }
            
            function initProofQuiz() {
                const steps = [
                    { statement: '1. ‚à†1 and ‚à†2 are complementary.', reason: 'Given', locked: true },
                    { statement: '2. ‚à†1 ‚âÖ ‚à†3', reason: 'Given', locked: true },
                    { statement: '3. m‚à†1 + m‚à†2 = 90¬∞', reason: 'Definition of Complementary', locked: false },
                    { statement: '4. m‚à†1 = m‚à†3', reason: 'Definition of Congruent', locked: false },
                    { statement: '5. m‚à†3 + m‚à†2 = 90¬∞', reason: 'Substitution Property', locked: false },
                    { statement: '6. ‚à†3 and ‚à†2 are complementary.', reason: 'Definition of Complementary', locked: false },
                ];
                practiceState.proofSteps = steps;
                practiceState.reasonOptions = shuffle([
                    'Given',
                    'Definition of Complementary',
                    'Definition of Congruent',
                    'Substitution Property',
                    'Linear Pair Postulate',
                    'Definition of Supplementary'
                ]);
                
                const tableBody = document.getElementById('proof-table-body');
                tableBody.innerHTML = '';
                
                steps.forEach((step, index) => {
                    let reasonHtml = '';
                    if (step.locked) {
                        reasonHtml = `<td class="border p-2 bg-gray-100">${step.reason}</td>`;
                    } else {
                        const options = practiceState.reasonOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                        reasonHtml = `
                            <td class="border p-2">
                                <select id="reason-select-${index}" class="w-full p-2 border-2 border-gray-300 rounded-lg" data-correct-reason="${step.reason}">
                                    <option value="">Select a reason...</option>
                                    ${options}
                                </select>
                            </td>
                        `;
                    }
                    
                    tableBody.innerHTML += `
                        <tr>
                            <td class="border p-2">${step.statement}</td>
                            ${reasonHtml}
                        </tr>
                    `;
                });
                
                tableBody.addEventListener('change', checkProofAnswers);
            }
            
            function checkProofAnswers() {
                let allCorrect = true;
                const feedbackEl = document.getElementById('practice-feedback');
                
                practiceState.proofSteps.forEach((step, index) => {
                    if (!step.locked) {
                        const select = document.getElementById(`reason-select-${index}`);
                        const correctReason = select.dataset.correctReason;
                        
                        if (select.value === "") {
                            allCorrect = false; // Not finished yet
                            select.style.borderColor = '#d1d5db'; // gray-300
                        } else if (select.value === correctReason) {
                            select.style.borderColor = '#10b981'; // green-500
                            select.disabled = true;
                        } else {
                            select.style.borderColor = '#ef4444'; // red-500
                            allCorrect = false;
                        }
                    }
                });
                
                if (allCorrect) {
                    feedbackEl.innerHTML = `<span class="text-green-600">Excellent! You completed the proof!</span>`;
                    showModal('Proof Complete!', 'You logic is flawless! Great job.', true);
                    practiceState.score = 1; // 1 point for the whole proof
                    practiceState.currentQuestion = 1;
                    modalNextBtn.onclick = () => {
                        hideModal();
                        showFinalScore('proof');
                    };
                } else {
                    feedbackEl.innerHTML = `<span class="text-blue-600">Keep going... Check the red boxes.</span>`;
                }
            }
            
            // --- Construction Logic ---
            
            function initConstructionLearn(type) {
                const steps = (type === 'bisector') ? getBisectorSteps() : getCongruentSteps();
                practiceState.steps = steps;
                practiceState.currentStep = 0;
                renderConstructionStep();
            }
            
            function renderConstructionStep() {
                const steps = practiceState.steps;
                const i = practiceState.currentStep;
                const container = document.getElementById('construction-steps');
                
                container.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h4 class="text-xl font-bold text-blue-700 mb-3">Step ${i + 1} of ${steps.length}</h4>
                        <p class="text-gray-700 text-lg mb-4">${steps[i].text}</p>
                        <div class="w-full flex justify-center bg-gray-100 p-4 rounded-lg">
                            ${steps[i].svg}
                        </div>
                        <div class="flex justify-between mt-6">
                            <button id="prev-step-btn" class="btn-option py-2 px-5 rounded-full font-semibold ${i === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${i === 0 ? 'disabled' : ''}>Previous</button>
                            <button id="next-step-btn" class="btn-primary py-2 px-5 rounded-full font-semibold">${i === steps.length - 1 ? 'Finish' : 'Next Step'}</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('prev-step-btn').addEventListener('click', () => {
                    if (practiceState.currentStep > 0) {
                        practiceState.currentStep--;
                        renderConstructionStep();
                    }
                });
                
                document.getElementById('next-step-btn').addEventListener('click', () => {
                    if (practiceState.currentStep < steps.length - 1) {
                        practiceState.currentStep++;
                        renderConstructionStep();
                    } else {
                        container.innerHTML = `<div class="bg-white rounded-xl shadow-lg p-8 text-center">
                            <h3 class="text-2xl font-bold text-green-600">Construction Complete!</h3>
                            <p class="text-lg text-gray-700 mt-4">Great! You've learned the steps. Now try to put them in order in the Practice tab!</p>
                            <button id="restart-construction" class="btn-primary mt-6 py-2 px-6 rounded-full font-semibold">Review Again</button>
                        </div>`;
                        document.getElementById('restart-construction').addEventListener('click', () => initConstructionLearn(currentTopic === 'construct-bisector' ? 'bisector' : 'congruent'));
                    }
                });
            }
            
            function getBisectorSteps() {
                // SVGs for each step of bisecting an angle
                const stepSvgs = [
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 50 120 L 150 120 L 50 120 L 120 50" stroke="#888" stroke-width="3" fill="none" /><text x="125" y="50" fill="#888">A</text><text x="40" y="125">B</text><text x="155" y="125">C</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 50 120 L 150 120 L 50 120 L 120 50" stroke="#888" stroke-width="3" fill="none" /><path d="M 120 50 A 40 40 0 0 0 90 85" stroke="#f87171" stroke-width="2" fill="none"/><path d="M 120 50 A 40 40 0 0 0 145 90" stroke="#f87171" stroke-width="2" fill="none"/><text x="85" y="85">P</text><text x="145" y="100">Q</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 50 120 L 150 120 L 50 120 L 120 50" stroke="#888" stroke-width="3" fill="none" /><path d="M 120 50 A 40 40 0 0 0 90 85" stroke="#888" stroke-width="2" fill="none"/><path d="M 120 50 A 40 40 0 0 0 145 90" stroke="#888" stroke-width="2" fill="none"/><path d="M 90 85 A 30 30 0 0 1 120 90" stroke="#3b82f6" stroke-width="2" fill="none"/></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 50 120 L 150 120 L 50 120 L 120 50" stroke="#888" stroke-width="3" fill="none" /><path d="M 120 50 A 40 40 0 0 0 90 85" stroke="#888" stroke-width="2" fill="none"/><path d="M 120 50 A 40 40 0 0 0 145 90" stroke="#888" stroke-width="2" fill="none"/><path d="M 90 85 A 30 30 0 0 1 120 90" stroke="#3b82f6" stroke-width="2" fill="none"/><path d="M 145 90 A 30 30 0 0 0 120 90" stroke="#3b82f6" stroke-width="2" fill="none"/><text x="120" y="95">R</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 50 120 L 150 120 L 50 120 L 120 50" stroke="#888" stroke-width="3" fill="none" /><path d="M 120 50 L 120 95" stroke="#f87171" stroke-width="3" stroke-dasharray="5 5" fill="none"/><text x="120" y="95">R</text></svg>`,
                ];
                return [
                    { text: 'Start with your angle, ‚à†ABC, with vertex A.', svg: stepSvgs[0] },
                    { text: 'Place the compass on the vertex A. Draw an arc that intersects both rays of the angle. Label the intersection points P and Q.', svg: stepSvgs[1] },
                    { text: 'Place the compass on point P. Draw an arc in the interior of the angle.', svg: stepSvgs[2] },
                    { text: 'Without changing the compass width, place the compass on point Q. Draw another arc that intersects the previous one. Label this point R.', svg: stepSvgs[3] },
                    { text: 'Use your straightedge to draw a ray from the vertex A through point R. This ray, AR, is the angle bisector!', svg: stepSvgs[4] },
                ];
            }
            
            function getCongruentSteps() {
                // Simplified SVGs for constructing a congruent angle
                const stepSvgs = [
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 20 120 L 80 120 L 20 120 L 60 60" stroke="#888" stroke-width="3" fill="none" /><text x="15" y="125">A</text><path d="M 120 120 L 180 120" stroke="#888" stroke-width="3" fill="none"/><text x="115" y="125">P</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 20 120 L 80 120 L 20 120 L 60 60" stroke="#888" stroke-width="3" fill="none" /><path d="M 20 120 A 30 30 0 0 1 45 100" stroke="#f87171" stroke-width="2" fill="none"/><path d="M 20 120 A 30 30 0 0 1 60 105" stroke="#f87171" stroke-width="2" fill="none"/><text x="40" y="100">B</text><text x="65" y="105">C</text><path d="M 120 120 L 180 120" stroke="#888" stroke-width="3" fill="none"/><path d="M 120 120 A 30 30 0 0 1 145 100" stroke="#3b82f6" stroke-width="2" fill="none"/><text x="140" y="100">Q</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 20 120 L 80 120 L 20 120 L 60 60" stroke="#888" stroke-width="3" fill="none" /><path d="M 20 120 A 30 30 0 0 1 45 100" stroke="#888" stroke-width="2" fill="none"/><path d="M 20 120 A 30 30 0 0 1 60 105" stroke="#888" stroke-width="2" fill="none"/><path d="M 45 100 A 20 20 0 0 1 60 105" stroke="#f87171" stroke-width="2" fill="none"/><text x="50" y="100">Open to BC</text><path d="M 120 120 L 180 120" stroke="#888" stroke-width="3" fill="none"/><path d="M 120 120 A 30 30 0 0 1 145 100" stroke="#888" stroke-width="2" fill="none"/></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 120 120 L 180 120" stroke="#888" stroke-width="3" fill="none"/><path d="M 120 120 A 30 30 0 0 1 145 100" stroke="#888" stroke-width="2" fill="none"/><path d="M 145 100 A 20 20 0 0 1 140 80" stroke="#3b82f6" stroke-width="2" fill="none"/><text x="135" y="80">R</text></svg>`,
                    `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M 120 120 L 180 120" stroke="#888" stroke-width="3" fill="none"/><path d="M 120 120 L 140 80" stroke="#f87171" stroke-width="3" stroke-dasharray="5 5" fill="none"/><text x="115" y="125">P</text><text x="135" y="80">R</text></svg>`,
                ];
                return [
                    { text: 'Start with the angle to copy (‚à†A) and a new ray with endpoint P.', svg: stepSvgs[0] },
                    { text: 'Place the compass on vertex A and draw an arc that intersects both rays. Label them B and C. Without changing width, draw the same arc from P, creating point Q.', svg: stepSvgs[1] },
                    { text: 'Set your compass width to the distance between points B and C.', svg: stepSvgs[2] },
                    { text: 'Place the compass on point Q. Draw an arc that intersects the first arc. Label this intersection R.', svg: stepSvgs[3] },
                    { text: 'Draw a ray from P through R. The new angle, ‚à†P, is congruent to ‚à†A!', svg: stepSvgs[4] },
                ];
            }
            
            function initConstructionDragDrop(type) {
                const steps = (type === 'bisector') ? getBisectorSteps() : getCongruentSteps();
                const stepTexts = steps.map((s, i) => ({ id: `step-${i}`, text: s.text }));
                
                practiceState.correctOrder = stepTexts.map(s => s.id);
                
                const draggableList = document.getElementById('draggable-steps');
                draggableList.innerHTML = shuffle(stepTexts).map(s => `
                    <li id="${s.id}" class="bg-blue-100 p-3 rounded-lg shadow cursor-grab" draggable="true">${s.text}</li>
                `).join('');
                
                const droppableArea = document.getElementById('droppable-area');
                let draggedItem = null;
                
                draggableList.addEventListener('dragstart', (e) => {
                    draggedItem = e.target;
                    setTimeout(() => e.target.style.display = 'none', 0);
                });
                
                draggableList.addEventListener('dragend', (e) => {
                    setTimeout(() => {
                        if (draggedItem) {
                            draggedItem.style.display = 'block';
                            draggedItem = null;
                        }
                    }, 0);
                });

                droppableArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                
                droppableArea.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    droppableArea.style.backgroundColor = '#dbeafe'; // blue-100
                });
                
                droppableArea.addEventListener('dragleave', () => {
                    droppableArea.style.backgroundColor = '';
                });
                
                droppableArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedItem) {
                        droppableArea.appendChild(draggedItem);
                        draggedItem.style.display = 'block'; // Make sure it's visible
                        draggedItem = null;
                    }
                    droppableArea.style.backgroundColor = '';
                });
                
                document.getElementById('check-order-btn').addEventListener('click', () => {
                    const droppedItems = Array.from(droppableArea.querySelectorAll('li'));
                    const droppedIds = droppedItems.map(item => item.id);
                    
                    let isCorrect = droppedIds.length === practiceState.correctOrder.length;
                    
                    droppedItems.forEach((item, index) => {
                        if (droppedIds[index] === practiceState.correctOrder[index]) {
                            item.style.border = '2px solid #10b981'; // green-500
                        } else {
                            item.style.border = '2px solid #ef4444'; // red-500
                            isCorrect = false;
                        }
                    });
                    
                    const feedbackEl = document.getElementById('practice-feedback');
                    if (isCorrect) {
                        feedbackEl.innerHTML = `<span class="text-green-600">Perfect! That's the correct order!</span>`;
                        showModal('Correct Order!', 'You know your constructions!', true);
                        practiceState.score = 1;
                        practiceState.currentQuestion = 1;
                        modalNextBtn.onclick = () => {
                            hideModal();
                            showFinalScore('construction');
                        };
                    } else {
                        feedbackEl.innerHTML = `<span class="text-red-600">Not quite! Check the red borders and try again.</span>`;
                    }
                });
            }

            // --- FINAL SCORE & UTILITY ---
            
            function showFinalScore(quizType) {
                const total = practiceState.questions ? practiceState.questions.length : (practiceState.currentQuestion > 0 ? 1 : 0);
                const score = practiceState.score;
                
                let message = `You finished the drill!`;
                if (total > 0) {
                   message = `You got ${score} out of ${total} correct!`;
                } else if (quizType === 'proof' || quizType === 'construction') {
                    message = score === 1 ? `You completed the ${quizType} successfully!` : `You've completed the ${quizType} section.`;
                }

                contentContainer.innerHTML = `
                    <div class="practice-card rounded-xl shadow-lg p-8 text-center">
                        <h3 class="text-3xl font-bold text-blue-700 mb-4">Drill Complete!</h3>
                        <p class="text-2xl text-gray-700 mb-6">${message}</p>
                        <div class="text-6xl mb-8">${score === total && total > 0 ? 'üèÜ' : (score > 0 ? 'üéâ' : 'ü§î')}</div>
                        <button id="restart-practice-btn" class="btn-primary py-3 px-8 rounded-full font-semibold text-lg">
                            Practice Again
                        </button>
                    </div>
                `;
                
                document.getElementById('restart-practice-btn').addEventListener('click', () => {
                    renderContent(); // This will re-run the init for the practice mode
                });
            }

            function showModal(title, message, isCorrect = true) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                
                if (isCorrect) {
                    modalContent.style.borderTop = '10px solid #10b981'; // green-500
                    modalTitle.style.color = '#10b981';
                    modalNextBtn.className = 'btn-primary mt-8 py-3 px-8 rounded-full font-semibold text-lg';
                } else {
                    modalContent.style.borderTop = '10px solid #ef4444'; // red-500
                    modalTitle.style.color = '#ef4444';
                    // Use a more subdued button for incorrect answers
                    modalNextBtn.className = 'btn-primary mt-8 py-3 px-8 rounded-full font-semibold text-lg bg-gray-600 hover:bg-gray-700';
                }
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.add('scale-100');
                    modalContent.classList.remove('scale-95');
                }, 10);
            }

            function hideModal() {
                modalContent.classList.add('scale-95');
                modalContent.classList.remove('scale-100');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            }
            
            function shuffle(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [
                        array[randomIndex], array[currentIndex]];
                }
                return array;
            }

            // --- START THE APP ---
            initializeApp();
        });
    </script>
</body>
</html>