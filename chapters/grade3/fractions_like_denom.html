
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ§® Fraction Addition Master - Grade 3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .fraction-bar {
      transition: all 0.3s ease;
    }
    
    .fraction-segment {
      transition: all 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
      border-right: 1px solid rgba(255,255,255,0.3);
    }
    
    .fraction-segment:last-child {
      border-right: none;
    }
    
    .fraction-segment.filled {
      background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
      transform: scaleY(1.02);
    }
    
    .fraction-segment.filled-alt {
      background: linear-gradient(135deg, #4ecdc4, #7fdbda);
    }
    
    .fraction-segment.result {
      background: linear-gradient(135deg, #ffd93d, #ffe066);
      animation: pulse 1s ease-in-out;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(1.05); }
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .bounce-in {
      animation: bounceIn 0.6s ease-out;
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>

</head>
<body class="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-blue-100">
    
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-center items-center gap-3 mb-4">
                <span class="text-4xl">ðŸ§®</span>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-800">
                    Fraction Addition Master
                </h1>
            </div>
            <p class="text-slate-600 text-lg">
                Add fractions with like denominators using visual bars and step-by-step guidance
            </p>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-2 gap-8">
            
            <!-- Left Panel - Problem Setup -->
            <div class="glass-card rounded-3xl p-6 space-y-6">
                <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">1</span>
                    Create Your Problem
                </h2>
                
                <!-- Problem Type Selection -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Choose Problem Type:</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button id="sameDenoBtn" class="px-4 py-3 bg-green-500 text-white rounded-xl font-medium hover:bg-green-600 transition-colors">
                                Same Denominators
                            </button>
                            <button id="practiceBtn" class="px-4 py-3 bg-purple-500 text-white rounded-xl font-medium hover:bg-purple-600 transition-colors">
                                Practice Mode
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Fraction Inputs -->
                <div id="fractionInputs" class="space-y-4">
                    <div class="bg-white rounded-2xl p-4 border-2 border-blue-200">
                        <label class="block text-sm font-medium text-slate-700 mb-3">First Fraction:</label>
                        <div class="flex items-center justify-center gap-3">
                            <input id="num1" type="number" min="1" max="10" value="1" 
                                   class="w-16 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <div class="text-2xl font-bold text-slate-600">/</div>
                            <input id="den1" type="number" min="2" max="12" value="4" 
                                   class="w-16 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <span class="text-3xl font-bold text-slate-600">+</span>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-4 border-2 border-green-200">
                        <label class="block text-sm font-medium text-slate-700 mb-3">Second Fraction:</label>
                        <div class="flex items-center justify-center gap-3">
                            <input id="num2" type="number" min="1" max="10" value="2" 
                                   class="w-16 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <div class="text-2xl font-bold text-slate-600">/</div>
                            <input id="den2" type="number" min="2" max="12" value="4" 
                                   class="w-16 h-12 text-center text-xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-3">
                    <button id="visualizeBtn" class="w-full px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors">
                        Show Visual Solution
                    </button>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="newProblemBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            New Problem
                        </button>
                        <button id="hintBtn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                            Show Hint
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Visual Solution -->
            <div class="glass-card rounded-3xl p-6 space-y-6">
                <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="w-8 h-8 bg-green-500 text-white rounded-lg flex items-center justify-center text-sm font-bold">2</span>
                    Visual Solution
                </h2>
                
                <!-- Problem Display -->
                <div id="problemDisplay" class="text-center py-4 bg-white rounded-2xl border-2 border-slate-200">
                    <div class="text-2xl font-bold text-slate-800">
                        <span id="displayNum1">1</span>/<span id="displayDen1">4</span> + 
                        <span id="displayNum2">2</span>/<span id="displayDen2">4</span> = 
                        <span id="resultDisplay" class="text-green-600">?</span>
                    </div>
                </div>

                <!-- Visual Bars -->
                <div id="visualBars" class="space-y-6">
                    <!-- First fraction bar -->
                    <div class="space-y-2">
                        <div class="text-sm font-medium text-slate-700">First Fraction:</div>
                        <div id="bar1" class="h-12 bg-gray-200 rounded-lg overflow-hidden flex">
                            <!-- Segments will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Second fraction bar -->
                    <div class="space-y-2">
                        <div class="text-sm font-medium text-slate-700">Second Fraction:</div>
                        <div id="bar2" class="h-12 bg-gray-200 rounded-lg overflow-hidden flex">
                            <!-- Segments will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Result bar -->
                    <div class="space-y-2">
                        <div class="text-sm font-medium text-slate-700">Result (Combined):</div>
                        <div id="resultBar" class="h-12 bg-gray-200 rounded-lg overflow-hidden flex">
                            <!-- Segments will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Step-by-step explanation -->
                <div id="explanation" class="bg-blue-50 rounded-2xl p-4 border border-blue-200 hidden">
                    <h3 class="font-bold text-blue-800 mb-2">Step-by-Step Solution:</h3>
                    <div id="explanationText" class="text-blue-700"></div>
                </div>

                <!-- Feedback -->
                <div id="feedback" class="text-center py-3 rounded-2xl hidden">
                    <!-- Feedback messages appear here -->
                </div>
            </div>
        </div>

        <!-- Score and Progress -->
        <div class="mt-8 text-center">
            <div class="inline-flex items-center gap-4 bg-white rounded-2xl px-6 py-3 shadow-lg border border-slate-200">
                <div class="text-sm text-slate-600">Score:</div>
                <div id="score" class="text-xl font-bold text-green-600">0 / 0</div>
                <div class="text-sm text-slate-600">â€¢</div>
                <div class="text-sm text-slate-600">Streak:</div>
                <div id="streak" class="text-xl font-bold text-purple-600">0</div>
            </div>
        </div>
    </div>

    <script>
        class FractionAdditionMaster {
            constructor() {
                this.score = 0;
                this.total = 0;
                this.streak = 0;
                this.currentProblem = null;
                
                this.initElements();
                this.bindEvents();
                this.generateNewProblem();
            }

            initElements() {
                // Input elements
                this.num1Input = document.getElementById('num1');
                this.den1Input = document.getElementById('den1');
                this.num2Input = document.getElementById('num2');
                this.den2Input = document.getElementById('den2');
                
                // Display elements
                this.displayNum1 = document.getElementById('displayNum1');
                this.displayDen1 = document.getElementById('displayDen1');
                this.displayNum2 = document.getElementById('displayNum2');
                this.displayDen2 = document.getElementById('displayDen2');
                this.resultDisplay = document.getElementById('resultDisplay');
                
                // Visual bars
                this.bar1 = document.getElementById('bar1');
                this.bar2 = document.getElementById('bar2');
                this.resultBar = document.getElementById('resultBar');
                
                // Controls
                this.visualizeBtn = document.getElementById('visualizeBtn');
                this.newProblemBtn = document.getElementById('newProblemBtn');
                this.hintBtn = document.getElementById('hintBtn');
                this.sameDenoBtn = document.getElementById('sameDenoBtn');
                this.practiceBtn = document.getElementById('practiceBtn');
                
                // Feedback elements
                this.explanation = document.getElementById('explanation');
                this.explanationText = document.getElementById('explanationText');
                this.feedback = document.getElementById('feedback');
                this.scoreEl = document.getElementById('score');
                this.streakEl = document.getElementById('streak');
            }

            bindEvents() {
                this.visualizeBtn.addEventListener('click', () => this.visualizeSolution());
                this.newProblemBtn.addEventListener('click', () => this.generateNewProblem());
                this.hintBtn.addEventListener('click', () => this.showHint());
                this.sameDenoBtn.addEventListener('click', () => this.setSameNumerators());
                this.practiceBtn.addEventListener('click', () => this.practiceMode());
                
                // Auto-update display when inputs change
                [this.num1Input, this.den1Input, this.num2Input, this.den2Input].forEach(input => {
                    input.addEventListener('input', () => this.updateProblemDisplay());
                });
                
                // Validate inputs
                [this.num1Input, this.num2Input].forEach(input => {
                    input.addEventListener('change', () => {
                        const val = parseInt(input.value);
                        const maxVal = parseInt(input === this.num1Input ? this.den1Input.value : this.den2Input.value);
                        if (val > maxVal) input.value = maxVal;
                        if (val < 1) input.value = 1;
                    });
                });
            }

            gcd(a, b) {
                return b === 0 ? a : this.gcd(b, a % b);
            }

            simplifyFraction(num, den) {
                const divisor = this.gcd(num, den);
                return { num: num / divisor, den: den / divisor };
            }

            generateNewProblem() {
                // Generate fractions with same denominator for Grade 3
                const denominator = Math.floor(Math.random() * 6) + 3; // 3-8
                const num1 = Math.floor(Math.random() * (denominator - 1)) + 1;
                const num2 = Math.floor(Math.random() * (denominator - num1)) + 1; // Ensure sum <= denominator for proper fractions
                
                this.num1Input.value = num1;
                this.den1Input.value = denominator;
                this.num2Input.value = num2;
                this.den2Input.value = denominator;
                
                this.updateProblemDisplay();
                this.clearVisualization();
            }

            setSameNumerators() {
                const denominator = Math.floor(Math.random() * 4) + 4; // 4-7 for easier visualization
                this.den1Input.value = denominator;
                this.den2Input.value = denominator;
                this.updateProblemDisplay();
            }

            practiceMode() {
                // Generate a variety of problems including improper results
                const denominator = [2, 3, 4, 5, 6][Math.floor(Math.random() * 5)];
                const num1 = Math.floor(Math.random() * denominator) + 1;
                const num2 = Math.floor(Math.random() * denominator) + 1;
                
                this.num1Input.value = num1;
                this.den1Input.value = denominator;
                this.num2Input.value = num2;
                this.den2Input.value = denominator;
                
                this.updateProblemDisplay();
                this.clearVisualization();
            }

            updateProblemDisplay() {
                this.displayNum1.textContent = this.num1Input.value;
                this.displayDen1.textContent = this.den1Input.value;
                this.displayNum2.textContent = this.num2Input.value;
                this.displayDen2.textContent = this.den2Input.value;
                this.resultDisplay.textContent = '?';
            }

            createFractionBar(container, numerator, denominator, colorClass = 'filled') {
                container.innerHTML = '';
                
                for (let i = 0; i < denominator; i++) {
                    const segment = document.createElement('div');
                    segment.className = `fraction-segment flex-1 h-full flex items-center justify-center text-sm font-bold text-white`;
                    
                    if (i < numerator) {
                        segment.classList.add(colorClass);
                        segment.textContent = i === Math.floor(numerator / 2) ? `${numerator}/${denominator}` : '';
                    } else {
                        segment.classList.add('bg-gray-300');
                    }
                    
                    container.appendChild(segment);
                }
            }

            visualizeSolution() {
                const num1 = parseInt(this.num1Input.value);
                const den1 = parseInt(this.den1Input.value);
                const num2 = parseInt(this.num2Input.value);
                const den2 = parseInt(this.den2Input.value);

                // Validate same denominators for Grade 3
                if (den1 !== den2) {
                    this.showFeedback('For Grade 3, we focus on adding fractions with the same denominator!', 'warning');
                    this.den2Input.value = den1;
                    return;
                }

                // Calculate result
                const resultNum = num1 + num2;
                const resultDen = den1;
                const simplified = this.simplifyFraction(resultNum, resultDen);

                // Update result display
                if (simplified.num === simplified.den) {
                    this.resultDisplay.textContent = '1';
                } else if (simplified.num > simplified.den) {
                    const whole = Math.floor(simplified.num / simplified.den);
                    const remainder = simplified.num % simplified.den;
                    this.resultDisplay.textContent = remainder === 0 ? whole : `${whole} ${remainder}/${simplified.den}`;
                } else {
                    this.resultDisplay.textContent = `${simplified.num}/${simplified.den}`;
                }

                // Create visual bars with animation delay
                setTimeout(() => this.createFractionBar(this.bar1, num1, den1, 'filled'), 100);
                setTimeout(() => this.createFractionBar(this.bar2, num2, den2, 'filled-alt'), 300);
                setTimeout(() => this.createFractionBar(this.resultBar, resultNum, resultDen, 'result'), 500);

                // Show explanation
                this.showExplanation(num1, den1, num2, den2, resultNum, resultDen, simplified);
                this.updateScore(true);
                
                // Celebration for correct answer
                if (resultNum <= resultDen * 2) { // Reasonable result
                    this.showConfetti();
                }
            }

            showExplanation(num1, den1, num2, den2, resultNum, resultDen, simplified) {
                let explanation = `
                    <div class="space-y-2">
                        <div><strong>Step 1:</strong> Both fractions have the same denominator (${den1}), so we can add them directly.</div>
                        <div><strong>Step 2:</strong> Add the numerators: ${num1} + ${num2} = ${resultNum}</div>
                        <div><strong>Step 3:</strong> Keep the denominator the same: ${resultNum}/${resultDen}</div>
                `;
                
                if (simplified.num !== resultNum || simplified.den !== resultDen) {
                    explanation += `<div><strong>Step 4:</strong> Simplify if possible: ${resultNum}/${resultDen} = ${simplified.num}/${simplified.den}</div>`;
                }
                
                if (simplified.num > simplified.den) {
                    const whole = Math.floor(simplified.num / simplified.den);
                    const remainder = simplified.num % simplified.den;
                    explanation += `<div><strong>Note:</strong> This is an improper fraction. As a mixed number: ${whole} ${remainder}/${simplified.den}</div>`;
                }
                
                explanation += '</div>';
                
                this.explanationText.innerHTML = explanation;
                this.explanation.classList.remove('hidden');
                this.explanation.classList.add('bounce-in');
            }

            showHint() {
                const den1 = parseInt(this.den1Input.value);
                const den2 = parseInt(this.den2Input.value);
                
                if (den1 !== den2) {
                    this.showFeedback('ðŸ’¡ Hint: Make sure both fractions have the same denominator first!', 'info');
                } else {
                    this.showFeedback('ðŸ’¡ Hint: When denominators are the same, just add the top numbers (numerators) and keep the bottom number (denominator) the same!', 'info');
                }
            }

            showFeedback(message, type = 'success') {
                this.feedback.className = `text-center py-3 rounded-2xl block ${
                    type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                    type === 'warning' ? 'bg-yellow-100 text-yellow-800 border border-yellow-200' :
                    'bg-blue-100 text-blue-800 border border-blue-200'
                }`;
                this.feedback.textContent = message;
                this.feedback.classList.remove('hidden');
                
                setTimeout(() => {
                    this.feedback.classList.add('hidden');
                }, 3000);
            }

            clearVisualization() {
                this.bar1.innerHTML = '';
                this.bar2.innerHTML = '';
                this.resultBar.innerHTML = '';
                this.explanation.classList.add('hidden');
                this.feedback.classList.add('hidden');
                this.resultDisplay.textContent = '?';
            }

            updateScore(correct) {
                this.total++;
                if (correct) {
                    this.score++;
                    this.streak++;
                } else {
                    this.streak = 0;
                }
                
                this.scoreEl.textContent = `${this.score} / ${this.total}`;
                this.streakEl.textContent = this.streak;
            }

            showConfetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new FractionAdditionMaster();
        });
    </script>
</body>
</html>
<script>
    (function(){
        const parts = location.pathname.split('/').filter(Boolean);
        const depth = Math.max(0, parts.length - 1);
        const prefix = '../'.repeat(depth);
        const s = document.createElement('script');
        s.src = prefix + 'assets/global-nav.js';
        s.defer = true;
        document.body.appendChild(s);
    })();
</script>
