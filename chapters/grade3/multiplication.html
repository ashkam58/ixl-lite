<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grade 3 â€¢ Multiplication with Cartoons</title>
  <link rel="stylesheet" href="../../assets/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Floating Background Shapes -->
  <!-- <div class="floating-shapes">
    <div class="floating-shape" style="top: 15%; left: 5%; font-size: 50px;">ğŸ¦¸â€â™€ï¸</div>
    <div class="floating-shape" style="top: 25%; right: 10%; font-size: 45px;">ğŸ¦„</div>
    <div class="floating-shape" style="top: 65%; left: 8%; font-size: 55px;">ğŸª</div>
    <div class="floating-shape" style="top: 75%; right: 5%; font-size: 40px;">ğŸŒŸ</div>
    <div class="floating-shape" style="top: 45%; left: 80%; font-size: 35px;">ğŸ­</div>
  </div> -->

  <div class="topbar">
    <div class="wrap">
      <div class="brand"><span class="logo"></span> AIS Practice</div>
      <a class="btn ghost" href="../../index.html">ğŸ  Home</a>
      <div class="row small muted" style="margin-left:auto">
        <span>Topic:</span><strong id="topic-title" style="color: var(--text-light);">âœ–ï¸ Grade 3 â€¢ Multiplication with Cartoons</strong>
      </div>
    </div>
  </div>

  <div class="container shell">
    <main>
      <section class="card prompt" id="prompt"></section>
      <section class="card workspace">
        <input id="answer" type="text" placeholder="Type your answerâ€¦" />
        <div class="actions">
          <button id="checkBtn" class="btn primary">âœ¨ Check</button>
          <button id="hintBtn" class="btn">ğŸ’¡ Hint</button>
          <button id="skipBtn" class="btn">â­ï¸ Skip</button>
          <button id="nextBtn" class="btn">â¡ï¸ Next</button>
        </div>
        <div id="feedback" class="feedback"></div>
      </section>
      <nav class="nav-rail">
        <button id="prevTopic" class="btn">â† Prev Topic</button>
        <button id="nextTopic" class="btn">Next Topic â†’</button>
      </nav>
    </main>
    <aside>
      <section class="card hud">
        <div class="tile">ğŸ† Score<br><strong id="score">0</strong></div>
        <div class="tile">ğŸ¯ Attempts<br><strong id="attempts">0</strong></div>
        <div class="tile">ğŸ“ˆ Mastery<br><strong id="mastery">0%</strong></div>
      </section>
      <section class="card">
        <div>ğŸ”¥ Streak: <strong id="streakVal">0</strong></div>
        <p class="small muted">Tip: Press Enter to submit faster.</p>
      </section>
      <section class="card">
        <h4 style="margin-top:0">ğŸ¯ Multiplication Tips</h4>
        <ul class="small" style="margin:0;padding-left:16px">
          <li>ğŸª Think of groups: 3 Ã— 4 = 3 groups of 4</li>
          <li>â• Use repeated addition: 3 Ã— 4 = 4 + 4 + 4</li>
          <li>ğŸ”¢ Practice skip counting: 2, 4, 6, 8...</li>
          <li>ğŸ‘ï¸ Visualize the story problems!</li>
        </ul>
      </section>
<script src="../../engine/ui.js"></script>
<script src="../../engine/core.js"></script>
<script>
  // --- Keyboard sugar ---
  document.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ document.getElementById('checkBtn').click(); } });

  // --- Topic loader (unchanged) ---
  const TOPIC_ID = "multiplication";
    window.IxlLite.loadTopic({
      topicId: TOPIC_ID,
      dataUrl: "../../data/multiplication.json",
      titleEl: document.getElementById("topic-title"),
      promptEl: document.getElementById("prompt"),
      answerEl: document.getElementById("answer"),
      feedbackEl: document.getElementById("feedback"),
      scoreEl: document.getElementById("score"),
      attemptsEl: document.getElementById("attempts"),
      masteryEl: document.getElementById("mastery"),
      streakEl: document.getElementById("streakVal"),
      buttons: {
        check: document.getElementById("checkBtn"),
        next: document.getElementById("nextBtn"),
        skip: document.getElementById("skipBtn"),
        hint: document.getElementById("hintBtn")
      },
      nav: {
        prevBtn: document.getElementById("prevTopic"),
        nextBtn: document.getElementById("nextTopic"),
        manifestUrl: "../../manifest.json"
      }
    });

    // --- Confetti (tiny canvas version, no libs) ---
    const c = document.getElementById('confettiCanvas');
    const ctx = c.getContext('2d');
    let particles = [];
    function resize(){ c.width = innerWidth; c.height = innerHeight }
    addEventListener('resize', resize); resize();

    function shootConfetti(bursts=160){
      particles.length = 0;
      for(let i=0;i<bursts;i++){
        particles.push({
          x: c.width/2, y: c.height*0.25,
          vx: (Math.random()*6-3), vy: (Math.random()*-6-2),
          g: 0.12 + Math.random()*0.08,
          w: 4+Math.random()*4, h: 8+Math.random()*8,
          a: Math.random()*Math.PI, va:(Math.random()-.5)*0.2,
          hue: Math.floor(200+ Math.random()*140)
        });
      }
      animateConfetti();
    }
    function animateConfetti(){
      ctx.clearRect(0,0,c.width,c.height);
      particles.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.vy += p.g; p.a += p.va;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
        ctx.fillStyle = `hsl(${p.hue} 90% 60%)`;
        ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
        ctx.restore();
      });
      particles = particles.filter(p=> p.y < c.height+20);
      if(particles.length) requestAnimationFrame(animateConfetti);
    }

    // --- Mascot talk + SFX (WebAudio beep, no files) ---
    const mascot = document.getElementById('mascot');
    const bubble = document.getElementById('mascotBubble');
    const linesGood = [
      "Boom! Tables tamed! ğŸ¯",
      "Math muscles flexed! ğŸ’ª",
      "Chefâ€™s kiss Ã— 3! ğŸ‘¨â€ğŸ³ğŸ˜™",
      "You multiplied the fun! ğŸ‰"
    ];
    const linesTry = [
      "Close! Count the groups ğŸ‘€",
      "Try skip-counting again! ğŸ”¢",
      "No stressâ€”math is practice ğŸŒˆ",
      "Tiny tweak and youâ€™ve got it! ğŸ§©"
    ];
    function say(text){
      bubble.textContent = text;
      mascot.classList.add('show');
      clearTimeout(say._t);
      say._t = setTimeout(()=> mascot.classList.remove('show'), 1600);
    }
    function beep(good=true){
      const actx = new (window.AudioContext||window.webkitAudioContext)();
      const o = actx.createOscillator();
      const g = actx.createGain();
      o.type='sine';
      o.frequency.value = good ? 880 : 220;
      o.connect(g); g.connect(actx.destination);
      g.gain.setValueAtTime(0.0001, actx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.2, actx.currentTime+.02);
      g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+.22);
      o.start(); o.stop(actx.currentTime+.24);
    }

    // --- Reactive flair when feedback changes (no engine mods needed) ---
    const feedbackEl = document.getElementById('feedback');
    const scoreEl = document.getElementById('score');
    const masteryEl = document.getElementById('mastery');
    const streakEl = document.getElementById('streakVal');
    const progressBar = document.getElementById('progressBar');
    const streakBar = document.getElementById('streakBar');

    const obs = new MutationObserver(()=>{
      const txt = feedbackEl.textContent.trim().toLowerCase();
      feedbackEl.classList.remove('good','oops');
      if(txt.includes('correct')){ // adjust keyword if your engine differs
        feedbackEl.classList.add('good');
        shootConfetti();
        say(linesGood[Math.floor(Math.random()*linesGood.length)]);
        beep(true);
        pulse(streakEl); pulse(masteryEl);
      }else if(txt && (txt.includes('try') || txt.includes('incorrect') || txt.includes('wrong'))){
        feedbackEl.classList.add('oops');
        say(linesTry[Math.floor(Math.random()*linesTry.length)]);
        beep(false);
      }
      // progress bars (safe parse)
      const masteryPct = parseInt((masteryEl.textContent||'0').replace('%',''),10) || 0;
      progressBar.style.width = Math.min(100, masteryPct) + '%';
      const streakVal = parseInt(streakEl.textContent||'0',10) || 0;
      streakBar.style.width = Math.min(100, streakVal*10) + '%';
    });
    obs.observe(feedbackEl,{childList:true,subtree:true,characterData:true});

    function pulse(el){ el.classList.remove('pulse'); void el.offsetWidth; el.classList.add('pulse'); }

    // --- Dynamic tip rotator to keep it lively ---
    const tipPool = [
      "3 Ã— 7 = 7 + 7 + 7 (three sevens!)",
      "Array trick: 3 Ã— 4 = 3 rows of 4 dots.",
      "Commutative magic: 3 Ã— 8 = 8 Ã— 3.",
      "Zero rule: 0 Ã— anything = 0.",
      "Ten rule: 10 Ã— n just add a zero."
    ];
    setInterval(()=>{
      const tips = document.getElementById('tips');
      const i = Math.floor(Math.random()*tipPool.length);
      const li = document.createElement('li');
      li.textContent = tipPool[i];
      li.className='small';
      tips.appendChild(li);
      if(tips.children.length>6) tips.removeChild(tips.firstElementChild);
    }, 4000);

    // --- Friendly placeholders when page loads ---
    window.addEventListener('load', ()=>{
      say("Ready to multiply? ğŸš€");
      setTimeout(()=>say("Type the answer & hit Enter! âŒ¨ï¸"), 1600);
    });
  </script>
  <script>
    (function(){
      const parts = location.pathname.split('/').filter(Boolean);
      const depth = Math.max(0, parts.length - 1);
      const prefix = '../'.repeat(depth);
      const s = document.createElement('script');
      s.src = prefix + 'assets/global-nav.js';
      s.defer = true;
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
