<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Abacus Bead Fun Lab</title>

  <!-- Cute font -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: "Baloo 2", system-ui, sans-serif;
      background: radial-gradient(circle at top, #ffe4f0, #fdf6ff 40%, #e0f7ff 90%);
      color: #333;
    }

    .app {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    h1 {
      text-align: center;
      margin: 10px 0 4px;
      font-size: 2.2rem;
      color: #ff6b6b;
      text-shadow: 0 2px 0 #fff;
    }
    .subtitle {
      text-align: center;
      margin-bottom: 16px;
      font-size: 1rem;
      color: #555;
    }

    .card {
      background: #ffffffdd;
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      border: 3px solid #ffd6fa;
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: stretch;
    }

    .abacus-wrapper {
      flex: 1 1 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .abacus-frame {
      position: relative;
      width: 160px;
      height: 260px;
      border-radius: 22px;
      border: 6px solid #ffb74d;
      background: linear-gradient(#fff9e6, #ffe3b3);
      padding: 18px 12px;
      box-shadow: inset 0 0 8px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .rod {
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
    }

    .upper-area,
    .lower-area {
      position: relative;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
    }

    .upper-area {
      height: 35%;
    }
    .lower-area {
      height: 50%;
    }

    .bar {
      width: 100%;
      height: 6px;
      border-radius: 8px;
      background: linear-gradient(90deg, #8d6e63, #5d4037);
      box-shadow: 0 3px 4px rgba(0,0,0,0.25);
    }

    .bead {
      width: 52px;
      height: 28px;
      border-radius: 999px;
      background: #ffb74d;
      box-shadow: 0 3px 0 rgba(205, 118, 25, 0.8);
      border: 2px solid rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
    }

    /* Upper bead resting vs active */
    .bead.upper {
      transform: translateY(-12px);
      background: #ffc46b;
    }
    .bead.upper.active {
      transform: translateY(10px);
      background: #ff7043;
      box-shadow: 0 3px 0 rgba(183, 60, 20, 0.9);
    }

    /* Lower beads resting vs active */
    .bead.lower {
      transform: translateY(10px);
      background: #c8e6c9;
      box-shadow: 0 3px 0 rgba(76,175,80,0.7);
    }
    .bead.lower.active {
      transform: translateY(-5px);
      background: #66bb6a;
      box-shadow: 0 3px 0 rgba(46,125,50,0.9);
    }

    .rod-label {
      text-align: center;
      margin-top: 8px;
      font-size: 0.9rem;
      color: #444;
    }

    .mode-panel {
      flex: 1 1 260px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: space-between;
    }

    .mode-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .mode-btn {
      flex: 1 1 140px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 0;
      font-weight: 600;
      background: #ffe082;
      cursor: pointer;
      box-shadow: 0 4px 0 #f4b400;
      font-size: 0.95rem;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    .mode-btn.active {
      background: #ffca28;
      transform: translateY(2px);
      box-shadow: 0 2px 0 #f4b400;
    }
    .mode-btn:active {
      transform: translateY(3px);
      box-shadow: 0 1px 0 #f4b400;
    }

    .info-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .question-text {
      font-size: 1.1rem;
    }

    .highlight-number {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      background: #fff3cd;
      border: 2px dashed #ffca28;
      font-weight: 700;
      font-size: 1.25rem;
      margin: 0 4px;
    }

    .current-value {
      font-size: 0.95rem;
      color: #555;
    }

    .controls-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .btn {
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #81d4fa;
      box-shadow: 0 4px 0 #039be5;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    .btn.secondary {
      background: #e1bee7;
      box-shadow: 0 4px 0 #ab47bc;
    }
    .btn:active {
      transform: translateY(3px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.25);
    }

    .message {
      min-height: 22px;
      margin-top: 8px;
      font-size: 0.98rem;
    }
    .message.ok {
      color: #2e7d32;
    }
    .message.bad {
      color: #c62828;
    }

    .scoreboard {
      margin-top: 4px;
      font-size: 0.9rem;
      color: #444;
    }

    .cat-tip {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      background: #fffde7;
      border: 2px dashed #ffe082;
      font-size: 0.9rem;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .cat-icon {
      font-size: 1.6rem;
    }

    /* Guess mode answer buttons */
    .answer-buttons {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(5, minmax(40px, 1fr));
      gap: 6px;
    }
    .answer-btn {
      padding: 6px 0;
      border-radius: 999px;
      border: none;
      background: #ffecb3;
      box-shadow: 0 3px 0 #f9a825;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    .answer-btn:hover {
      background: #ffe082;
    }
    .answer-btn:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 #f9a825;
    }

    /* Small screens */
    @media (max-width: 700px) {
      .abacus-frame {
        width: 140px;
        height: 230px;
      }
      .bead {
        width: 44px;
        height: 24px;
      }
    }

    footer {
      margin-top: 16px;
      text-align: center;
      font-size: 0.85rem;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Abacus Bead Fun Lab</h1>
    <p class="subtitle">Move the beads, make the numbers, and shower the screen with confetti! üéà</p>

    <div class="card">
      <div class="top-row">
        <!-- Abacus -->
        <div class="abacus-wrapper">
          <div class="abacus-frame">
            <div class="rod" id="rod">
              <div class="upper-area">
                <div class="bead upper" data-type="upper"></div>
              </div>
              <div class="bar"></div>
              <div class="lower-area">
                <div class="bead lower" data-index="0"></div>
                <div class="bead lower" data-index="1"></div>
                <div class="bead lower" data-index="2"></div>
                <div class="bead lower" data-index="3"></div>
              </div>
            </div>
          </div>
          <div class="rod-label">Each upper bead = 5 ‚Ä¢ Each lower bead = 1</div>
        </div>

        <!-- Controls / Modes -->
        <div class="mode-panel">
          <div class="mode-buttons">
            <button id="mode-build" class="mode-btn active">
              üßÆ Make beads from number
            </button>
            <button id="mode-guess" class="mode-btn">
              ü§î Guess number from beads
            </button>
          </div>

          <div class="info-row">
            <div class="question-text" id="question">
              Make this number: <span class="highlight-number" id="target-number">0</span>
            </div>
            <div class="current-value">
              Your abacus shows: <strong id="current-value">0</strong>
            </div>
          </div>

          <!-- Answer buttons for guess mode -->
          <div id="guess-area" style="display:none;">
            <div style="font-size:0.95rem; margin-top:4px;">
              Tap the correct number:
            </div>
            <div class="answer-buttons" id="answer-buttons"></div>
          </div>

          <div class="controls-row">
            <button class="btn" id="check-btn">‚úÖ Check</button>
            <button class="btn secondary" id="new-btn">üé≤ New Question</button>
            <button class="btn secondary" id="reset-btn">üîÑ Reset beads</button>
          </div>

          <div class="message" id="message"></div>

          <div class="scoreboard" id="scoreboard">
            Score: 0 ‚Ä¢ Streak: 0
          </div>

          <div class="cat-tip">
            <div class="cat-icon">üê±‚Äçüëì</div>
            <div id="tip-text">
              When the top bead hugs the bar, count 5. Then add the bottom beads.
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      Practice like a ninja on the abacus ‚Äî tiny beads, giant brain. üß†‚ú®
    </footer>
  </div>

  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    // ----- State -----
    let mode = "build"; // "build" or "guess"
    let targetNumber = 0;
    let score = 0;
    let streak = 0;
    let allowToggle = true;

    const upperBead = document.querySelector(".bead.upper");
    const lowerBeads = Array.from(document.querySelectorAll(".bead.lower"));
    const currentValueSpan = document.getElementById("current-value");
    const targetNumberSpan = document.getElementById("target-number");
    const messageBox = document.getElementById("message");
    const scoreboard = document.getElementById("scoreboard");
    const questionText = document.getElementById("question");
    const tipText = document.getElementById("tip-text");
    const guessArea = document.getElementById("guess-area");
    const answerButtonsContainer = document.getElementById("answer-buttons");

    const buildBtn = document.getElementById("mode-build");
    const guessBtn = document.getElementById("mode-guess");

    // ----- Utility functions -----
    function getRodValue() {
      let val = 0;
      if (upperBead.classList.contains("active")) val += 5;
      const activeLower = lowerBeads.filter(b => b.classList.contains("active")).length;
      val += activeLower;
      return val;
    }

    function updateCurrentValueDisplay() {
      currentValueSpan.textContent = getRodValue();
    }

    function resetRod() {
      upperBead.classList.remove("active");
      lowerBeads.forEach(b => b.classList.remove("active"));
      updateCurrentValueDisplay();
    }

    function configRodForDigit(d) {
      resetRod();
      if (d >= 5) {
        upperBead.classList.add("active");
      }
      const ones = d % 5;
      for (let i = 0; i < lowerBeads.length; i++) {
        if (i < ones) {
          lowerBeads[i].classList.add("active");
        } else {
          lowerBeads[i].classList.remove("active");
        }
      }
      updateCurrentValueDisplay();
    }

    function randomDigit() {
      return Math.floor(Math.random() * 10);
    }

    function fireConfetti() {
      const duration = 900;
      const end = Date.now() + duration;

      (function frame() {
        confetti({
          particleCount: 8,
          startVelocity: 24,
          spread: 70,
          origin: { x: Math.random(), y: Math.random() * 0.3 + 0.1 }
        });
        if (Date.now() < end) {
          requestAnimationFrame(frame);
        }
      })();
    }

    function setMessage(text, ok = true) {
      messageBox.textContent = text;
      messageBox.className = "message " + (ok ? "ok" : "bad");
    }

    function updateScore(ok) {
      if (ok) {
        score += 10;
        streak += 1;
      } else {
        streak = 0;
      }
      scoreboard.textContent = `Score: ${score} ‚Ä¢ Streak: ${streak}`;
    }

    // ----- Modes -----
    function setMode(newMode) {
      mode = newMode;
      allowToggle = mode === "build";

      if (mode === "build") {
        buildBtn.classList.add("active");
        guessBtn.classList.remove("active");
        guessArea.style.display = "none";
        document.getElementById("check-btn").style.display = "inline-block";
        tipText.textContent = "Match the target number by moving the beads. Then hit Check!";
        newBuildQuestion();
      } else {
        buildBtn.classList.remove("active");
        guessBtn.classList.add("active");
        guessArea.style.display = "block";
        document.getElementById("check-btn").style.display = "none"; // not needed in guess mode
        tipText.textContent = "Look at the beads and tap the correct number below.";
        createAnswerButtons();
        newGuessQuestion();
      }
    }

    // ----- Build mode -----
    function newBuildQuestion() {
      targetNumber = randomDigit();
      targetNumberSpan.textContent = targetNumber;
      questionText.textContent = "Make this number:";
      questionText.appendChild(targetNumberSpan);
      resetRod();
      setMessage("");
    }

    function checkBuild() {
      const val = getRodValue();
      if (val === targetNumber) {
        setMessage("Perfect! Your beads show " + val + " üéâ", true);
        updateScore(true);
        fireConfetti();
        newBuildQuestion();
      } else {
        setMessage(`Not yet! Your beads show ${val}. Try again.`, false);
        updateScore(false);
      }
    }

    // ----- Guess mode -----
    function createAnswerButtons() {
      answerButtonsContainer.innerHTML = "";
      for (let i = 0; i <= 9; i++) {
        const btn = document.createElement("button");
        btn.className = "answer-btn";
        btn.textContent = i;
        btn.dataset.value = i;
        btn.addEventListener("click", () => handleGuess(parseInt(btn.dataset.value, 10)));
        answerButtonsContainer.appendChild(btn);
      }
    }

    function newGuessQuestion() {
      targetNumber = randomDigit();
      configRodForDigit(targetNumber);
      questionText.textContent = "What number do the beads show?";
      setMessage("");
    }

    function handleGuess(choice) {
      if (mode !== "guess") return;
      if (choice === targetNumber) {
        setMessage(`Yes! The beads show ${choice}.`, true);
        updateScore(true);
        fireConfetti();
        newGuessQuestion();
      } else {
        setMessage(`Nice try, but it's ${targetNumber}. Look: top bead = 5, bottom beads add the rest.`, false);
        updateScore(false);
        // After showing explanation, show the correct number again with same beads
        setTimeout(() => {
          newGuessQuestion();
        }, 1500);
      }
    }

    // ----- Event listeners -----
    upperBead.addEventListener("click", () => {
      if (!allowToggle) return;
      upperBead.classList.toggle("active");
      updateCurrentValueDisplay();
    });

    lowerBeads.forEach(b => {
      b.addEventListener("click", () => {
        if (!allowToggle) return;
        b.classList.toggle("active");
        updateCurrentValueDisplay();
      });
    });

    document.getElementById("check-btn").addEventListener("click", checkBuild);
    document.getElementById("new-btn").addEventListener("click", () => {
      if (mode === "build") {
        newBuildQuestion();
      } else {
        newGuessQuestion();
      }
    });
    document.getElementById("reset-btn").addEventListener("click", resetRod);

    buildBtn.addEventListener("click", () => setMode("build"));
    guessBtn.addEventListener("click", () => setMode("guess"));

    // ----- Init -----
    setMode("build");
  </script>
</body>
</html>
